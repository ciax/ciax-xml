<?xml version="1.0" encoding="utf-8"?>
<cdb xsi:schemaLocation="http://ciax.sum.naoj.org/ciax-xml/schema/cdb.xsd" xmlns="http://ciax.sum.naoj.org/ciax-xml/cdb" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
  <class frame="mel" id="mel" label="Cart PLC">
    <commands xmlns="http://ciax.sum.naoj.org/ciax-xml/cdbc">
      <session id="upd" label="Regular status update">
        <statement command="getstat" />
      </session>
      <session id="run" label="Run to Destination Tag [1-12]">
        <statement command="set_tag">
          <argv valid="1:12">$1</argv>
        </statement>
        <statement command="start">
          <argv>0</argv>
        </statement>
        <statement command="getstat" />
      </session>
      <session id="fwd" label="Run Forward">
        <statement command="set_tag">
          <argv>98</argv>
        </statement>
        <statement command="start">
          <argv>0</argv>
        </statement>
        <statement command="getstat" />
      </session>
      <session id="bak" label="Run Backword">
        <statement command="set_tag">
          <argv>99</argv>
        </statement>
        <statement command="start">
          <argv>0</argv>
        </statement>
        <statement command="getstat" />
      </session>
      <session id="lift" label="Lift Jack Level [0-3]">
        <statement command="set_pos">
          <argv valid="0:3">$1</argv>
        </statement>
        <statement command="start">
          <argv>8</argv>
        </statement>
        <statement command="getstat" />
      </session>
      <session id="chgon" label="Start Charging">
        <statement command="start">
          <argv>15</argv>
        </statement>
        <statement command="clear" />
        <statement command="getstat" />
      </session>
      <session id="chgoff" label="Stop Charging">
        <statement command="stop">
          <argv format="%d">3</argv>
        </statement>
        <statement command="getstat" />
        <statement command="clear" />
        <statement command="getstat" />
      </session>
      <session id="pause" label="Pause">
        <statement command="stop">
          <argv>0</argv>
        </statement>
        <statement command="clear" />
      </session>
      <session id="emstop" label="Emergency Stop">
        <statement command="stop">
          <argv>1</argv>
        </statement>
        <statement command="clear" />
      </session>
      <session id="resume" label="Resume from Pause">
        <statement command="stop">
          <argv>5</argv>
        </statement>
        <statement command="clear" />
      </session>
      <session id="cancel" label="Command Cancel">
        <statement command="stop">
          <argv>4</argv>
        </statement>
        <statement command="clear" />
      </session>
      <session id="get_tbl" label="Get Jack Table">
        <statement command="rw_tbl">
          <argv>1</argv>
        </statement>
        <repeat counter="t" from="0" to="5">
          <repeat counter="j" from="0" to="3">
            <statement command="get_tbl">
              <argv>$t</argv>
              <argv>$j</argv>
            </statement>
          </repeat>
        </repeat>
      </session>
      <session id="set_tbl" label="Set Jack Table">
        <repeat counter="t" from="0" to="5">
          <repeat counter="j" from="0" to="3">
            <statement command="set_tbl">
              <argv>$t</argv>
              <argv>$j</argv>
            </statement>
          </repeat>
        </repeat>
        <statement command="rw_tbl">
          <argv>0</argv>
        </statement>
      </session>
    </commands>
    <status xmlns="http://ciax.sum.naoj.org/ciax-xml/cdbs">
      <row label="Group">
        <value id="ecode" label="EXIT CODE" symbol="ecode">
          <int format="%04X" ref="ecode" />
        </value>
        <value id="acp" label="CMD ACCEPT">
          <binary bit="6" ref="x:0" />
          <binary bit="0" ref="x:32" />
        </value>
        <value id="rdy" label="READY" symbol="normal">
          <binary bit="0" ref="x:0" />
        </value>
        <value id="pse" label="PAUSE" symbol="warn">
          <binary bit="1" ref="x:0" />
        </value>
        <value id="emg" label="ENERGENCY" symbol="alarm">
          <binary bit="2" ref="x:0" />
        </value>
        <value id="stp" label="STOP" symbol="warn">
          <binary bit="3" ref="x:0" />
        </value>
      </row>
      <row label="Group">
        <value id="run" label="RUNNING" symbol="normal">
          <binary bit="4" ref="x:0" />
        </value>
        <value id="jak" label="JACKING" symbol="normal">
          <binary bit="5" ref="x:0" />
        </value>
        <value id="con" label="CHARGING" symbol="normal">
          <binary bit="6" ref="x:0" />
        </value>
        <value id="flt" label="Fault" symbol="alarm">
          <binary bit="7" ref="x:0" />
        </value>
      </row>
      <row label="Group">
        <value id="msr" label="Right Motor Servo" symbol="normal">
          <binary bit="8" inv="true" ref="x:0" />
        </value>
        <value id="msl" label="Left Motor Servo" symbol="normal">
          <binary bit="9" inv="true" ref="x:0" />
        </value>
      </row>
      <row label="Group">
        <value id="jd1" label="Jack Motor Servo1" symbol="normal">
          <binary bit="10" inv="true" ref="x:0" />
        </value>
        <value id="jd2" label="Jack Motor Servo2" symbol="normal">
          <binary bit="11" inv="true" ref="x:0" />
        </value>
      </row>
      <row label="Group">
        <value id="jd3" label="Jack Motor Servo3" symbol="normal">
          <binary bit="12" inv="true" ref="x:0" />
        </value>
        <value id="jd4" label="Jack Motor Servo4" symbol="normal">
          <binary bit="13" inv="true" ref="x:0" />
        </value>
      </row>
      <row label="Group">
        <value id="mdar" label="Rignt Motor D/A" symbol="motor">
          <int ref="x:7" />
        </value>
        <value id="mdal" label="Left Motor D/A" symbol="motor">
          <int ref="x:8" />
        </value>
      </row>
      <row label="Group">
        <value id="bvl" label="Battery Voltage" symbol="bvl">
          <float format="%2.2f" ref="x:22" formula="$#/100" />
        </value>
        <value id="ist" label="Instrument" symbol="ist">
          <int ref="x:23" />
        </value>
      </row>
      <row label="Group">
        <value id="cpos" label="Current Position">
          <int ref="x:25" />
        </value>
        <value id="dpos" label="Destination Position">
          <int ref="x:26" />
        </value>
      </row>
      <row label="Group">
        <value id="jpos" label="Jack Position" symbol="jpos">
          <int ref="x:27" />
        </value>
      </row>
    </status>
    <watch xmlns="http://ciax.sum.naoj.org/ciax-xml/wdb" interval="1">
      <periodic period="3600">
        <statement command="getstat" />
      </periodic>
      <onchange label="CMD ACCEPT">
        <condition>
          <value ref="acp">00</value>
        </condition>
        <statement command="clear" />
      </onchange>
      <while blocking="run|jak|charge">
        <condition>
          <value ref="acp">00</value>
        </condition>
        <interrupt command="stop">
          <argv>0</argv>
        </interrupt>
        <statement command="getstat" />
      </while>
    </watch>
    <symbol xmlns="http://ciax.sum.naoj.org/ciax-xml/sdb">
      <table id="ecode" label="ExitCode" type="string">
        <case class="hide" msg="OK">0000</case>
        <case class="alarm" msg="RW Region Error">0002</case>
        <case class="alarm" msg="CMD Code Error">0050</case>
        <case class="alarm" msg="Devide Num Error">0056</case>
        <case class="alarm" msg="Communication Error">005B</case>
        <case class="alarm" msg="CPU Watch timeout Error">0060</case>
        <case class="alarm" msg="Unknown" />
      </table>
      <table id="motor" type="range">
        <case class="alarm" msg="LOW">:10</case>
        <case class="normal" msg="OK">10&lt;:30</case>
        <case class="alarm" msg="HIGH">30&lt;:</case>
      </table>
      <table id="bvl" type="range">
        <case class="alarm" msg="LOW">:20</case>
        <case class="warn" msg="LESS">20&lt;:22</case>
        <case class="normal" msg="OK">22&lt;:26</case>
        <case class="warn" msg="FULL">26&lt;:28</case>
        <case class="alarm" msg="HIGH">28&lt;:</case>
      </table>
      <table id="ist" type="string">
        <case class="normal" msg="MOIRCS">2</case>
        <case class="warn" msg="N/A" />
      </table>
      <table id="jpos" type="string">
        <case class="normal" msg="D">0</case>
        <case class="normal" msg="1(L)">1</case>
        <case class="normal" msg="2(M)">2</case>
        <case class="normal" msg="3(H)">3</case>
        <case class="normal" msg="CHG">4</case>
        <case class="warn" msg="N/A" />
      </table>
    </symbol>
  </class>
</cdb>