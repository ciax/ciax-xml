<?xml version="1.0" encoding="utf-8"?>
<cdb xmlns="http://ciax.sum.naoj.org/ciax-xml/cdb">
  <class frame="oss" id="oss" label="TSC Control">
    <commands xmlns="http://ciax.sum.naoj.org/ciax-xml/cdbc">
      <session id="upd" label="Update Status">
        <statement name="logstat" />
        <statement name="getstat" />
        <statement name="iststat" />
        <statement name="jakstat" />
        <statement name="inrstat" />
      </session>
      <session id="login" label="Login">
        <statement name="login" />
        <statement name="logstat" />
      </session>
      <session id="logout" label="Logout">
        <statement name="logout" />
        <statement name="logstat" />
      </session>
      <session id="init" label="Start TCP Status Request">
        <statement name="init" />
      </session>
      <session id="startup" label="Start Up CIAX operation">
        <statement name="login" />
        <statement name="tsconly" label="TSC Only Mode(CIAX Mode)" />
        <statement name="ron" />
        <statement name="jon" />
      </session>
      <session id="shutdown" label="Shutdown CIAX operation">
        <statement name="joff" />
        <statement name="roff" />
        <statement name="tscpri" label="TSC Primaly Mode" />
        <statement name="logout" />
      </session>
      <session id="rhook" label="InR Hook">
        <statement name="rhook" />
        <statement name="inrstat" />
      </session>
      <session id="runhk" label="InR UnHook">
        <statement name="runhk" />
        <statement name="inrstat" />
      </session>
      <session id="rstop" label="InR Stop">
        <statement name="rstop" />
        <statement name="inrstat" />
      </session>
      <session id="jup" label="All EJB Up">
        <statement name="ajup" />
        <statement name="jakstat" />
      </session>
      <session id="jdw" label="All EJB Down">
        <statement name="ajdw" />
        <statement name="jakstat" />
      </session>
      <session id="jstop" label="All EJB Stop">
        <statement name="jstop" />
        <statement name="jakstat" />
      </session>
      <session id="moircs" label="Set IID MOIRCS">
        <statement name="setinst">
          <argv>12</argv>
        </statement>
        <statement name="iststat" />
      </session>
      <session id="focas" label="Set IID FOCAS">
        <statement name="setinst">
          <argv>5</argv>
        </statement>
        <statement name="iststat" />
      </session>
      <session id="comics" label="Set IID COMICS">
        <statement name="setinst">
          <argv>7</argv>
        </statement>
        <statement name="iststat" />
      </session>
    </commands>
    <status xmlns="http://ciax.sum.naoj.org/ciax-xml/cdbs">
      <row label="Group">
        <value id="exit" label="Exit Code">
          <int ref="exit" />
        </value>
        <value id="nfb" label="BOLT NFB TRIP">
          <binary bit="6" ref="bstat" />
        </value>
      </row>
      <row label="Group">
        <value id="rts" label="ROT SEL" symbol="rts">
          <int ref="rsel" />
        </value>
        <value id="iid" label="CAS INST ID" symbol="iid">
          <int ref="iid" />
        </value>
        <value id="login" label="Login Status" symbol="login">
          <string ref="login0" />
          <string ref="login1" />
          <string ref="login2" />
          <string ref="login3" />
        </value>
      </row>
      <row label="AZ">
        <value id="azd" label="AZ DRIVE" symbol="drv">
          <binary label="ON" bit="0" ref="teldrive" />
          <binary label="OFF" bit="1" ref="teldrive" />
          <binary label="Ready" bit="2" ref="teldrive" />
        </value>
      </row>
      <row label="EL">
        <value id="eld" label="EL DRIVE" symbol="drv">
          <binary label="ON" bit="3" ref="teldrive" />
          <binary label="OFF" bit="4" ref="teldrive" />
          <binary label="Ready" bit="5" ref="teldrive" />
        </value>
        <value id="elv" label="EL Angle">
          <float ref="el" format="%.3f" />
        </value>
        <value id="stw" label="EL STOW" symbol="off-warn">
          <binary bit="2" ref="stow_1" />
        </value>
      </row>
      <row label="InR">
        <value id="rpw" label="ROT DRIVE" symbol="rpw">
          <int ref="rpw" />
        </value>
        <value id="iang" label="InR Angle">
          <float ref="iang" format="%.3f" />
        </value>
      </row>
      <row label="JACK PW">
        <value id="jpw" label="JAK DRIVE" symbol="warn">
          <binary bit="7" ref="bstat" />
        </value>
        <value id="rps" label="ROT POS SENSOR" symbol="rps">
          <binary bit="4" ref="bstat" />
          <binary bit="5" ref="bstat" />
        </value>
      </row>
      <row label="JACK ALL">
        <value id="abm" label="ALL Bolt MOVING" symbol="warn">
          <binary ref="abs" bit="2" inv="true" />
        </value>
        <value id="abs" label="ALL Bolt STAT(Anc,Rdy)">
          <binary ref="abs" bit="0" />
          <binary ref="abs" bit="4" />
        </value>
      </row>
      <repeat from="1" to="16">
        <row label="JACK EACH">
          <!--Order:2,1,4,3,6,5...-->
          <value id="jk%02d" label="Jack Len %02d">
            <float ref="jk:$_-2-($_%2)*2" formula="$#/100" format="%5.2f" />
          </value>
          <value id="bl%02d" label="Pos %02d" symbol="bl">
            <binary ref="bl:$_-2-($_%2)*2" bit="1" />
            <binary ref="bl:$_-2-($_%2)*2" bit="2" />
          </value>
          <value id="bm%02d" label="Moving %02d" symbol="warn">
            <binary ref="bs:$_-2-($_%2)*2" bit="2" inv="true" />
          </value>
          <value id="bs%02d" label="Stat %02d(Anc,Rdy,Clnt)">
            <binary ref="bs:$_-2-($_%2)*2" bit="0" />
            <binary ref="bs:$_-2-($_%2)*2" bit="4" />
            <binary ref="clm:1-($_-1)/8" bit="($_-1)%8" />
          </value>
          <value id="ba%02d" label="Alarm %02d" symbol="ba">
            <binary ref="bl:$_-2-($_%2)*2" bit="0" />
            <binary ref="bl:$_-2-($_%2)*2" bit="4" />
          </value>
          <value id="ba%02d" label="Alarm %02d">
            <binary ref="bl:$_-2-($_%2)*2" bit="0" />
            <binary ref="bl:$_-2-($_%2)*2" bit="4" />
          </value>
        </row>
      </repeat>
      <row label="Z Sensor">
        <repeat from="1" to="4">
          <value id="z%d" label="Z Len %d">
            <float ref="zp:$_-1" formula="$#/100" format="%5.2f" />
          </value>
        </repeat>
      </row>
    </status>
    <watch interval="1" xmlns="http://ciax.sum.naoj.org/ciax-xml/wdb">
      <while label="Moving Jack" blocking="jup|jdw">
        <condition>
          <value ref="abm">1</value>
        </condition>
        <interrupt name="jstop" />
        <statement name="jakstat" />
        <statement name="getexit" />
        <statement name="getpid" />
      </while>
      <onchange label="Moving InR" blocking="rhook|runhk">
        <condition>
          <value ref="iang"></value>
        </condition>
        <interrupt name="rstop" />
        <statement name="inrstat" />
        <statement name="getexit" />
        <statement name="getpid" />
      </onchange>
    </watch>
  </class>
  <symbol xmlns="http://ciax.sum.naoj.org/ciax-xml/sdb">
    <table id="bl" type="string">
      <case class="warn" msg="MID">00</case>
      <case class="normal" msg="UP">10</case>
      <case class="normal" msg="DW">01</case>
    </table>
    <table id="ba" type="string">
      <case class="hide" msg="OK">00</case>
      <case class="alarm" msg="ON" />
    </table>
    <table id="rts" type="string">
      <case class="warn" msg="PFO">1</case>
      <case class="warn" msg="PFI">2</case>
      <case class="normal" msg="CAS">4</case>
      <case class="warn" msg="NSO">8</case>
      <case class="warn" msg="NSI">10</case>
      <case class="alarm" msg="N/A" />
    </table>
    <table id="iid" type="string">
      <case class="warn" msg="NONE">0</case>
      <case class="normal" msg="IRCS">1</case>
      <case class="normal" msg="CIAO">3</case>
      <case class="normal" msg="FOCAS">5</case>
      <case class="normal" msg="COMICS">7</case>
      <case class="normal" msg="K3D">10</case>
      <case class="normal" msg="MOIRCS">12</case>
      <case class="normal" msg="CIAX3">13</case>
      <case class="warn" msg="N/A" />
    </table>
    <table id="login" type="regexp">
      <case class="alarm" msg="OSS Login">OSS</case>
      <case class="normal" msg="LOGIN">CXWS</case>
      <case class="warn" msg="LOGOUT" />
    </table>
    <table id="rpw" type="string">
      <case class="warn" msg="ON">1</case>
      <case class="normal" msg="OFF">2</case>
    </table>
    <table id="rps" type="string">
      <case class="alarm" msg="OFF">11</case>
      <case class="normal" msg="0DEG">10</case>
      <case class="normal" msg="-4DEG">01</case>
      <case class="alarm" msg="N/A" />
    </table>
    <table id="drv" type="string">
      <case class="alarm" msg="ON">101</case>
      <case class="normal" msg="OFF">011</case>
      <case class="normal" msg="RDY">001</case>
      <case class="alarm" msg="N/A" />
    </table>
  </symbol>
</cdb>
