<?xml version="1.0" encoding="iso-8859-1"?>
<cdb xsi:schemaLocation="http://ciax.sum.naoj.org/ciax-xml/schema/cdb.xsd" xmlns="http://ciax.sum.naoj.org/ciax-xml/cdb" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
  <class frame="cj2" id="cj2" label="Stand-by Flange PLC">
    <commands xmlns="http://ciax.sum.naoj.org/ciax-xml/cdbc">
      <session id="upd" label="Regular status update">
        <statement format="getstat" />
        <statement format="getzerr" />
        <statement format="getzlen" />
      </session>
      <session id="clr" label="ClearBit">
        <statement format="clrbit" />
        <statement format="getstat" />
      </session>
      <session id="stop" label="Emergency Stop">
        <statement format="setbit 0 0" />
        <statement format="getstat" />
      </session>
      <session id="pause" label="Pause">
        <statement format="setbit 0 1" />
        <statement format="getstat" />
      </session>
      <session id="ready" label="Drive Ready">
        <statement format="setbit 0 3" />
        <statement format="getstat" />
      </session>
      <session id="resume" label="Reset Pause">
        <statement format="setbit 0 10" />
        <statement format="getstat" />
      </session>
      <session id="reset" label="Reset Error">
        <statement format="setbit 0 11" />
        <statement format="getstat" />
      </session>
      <session id="fhook" label="Fix Flange Hook">
        <statement format="setbit 1 0" />
        <statement format="getstat" />
      </session>
      <session id="funhk" label="Fix Flange UnHook">
        <statement format="setbit 1 1" />
        <statement format="getstat" />
      </session>
      <session id="fjup" label="Fix Flange Jack Up">
        <statement format="setbit 1 4" />
        <statement format="getstat" />
      </session>
      <session id="fjdw" label="Fix Flange Jack Down">
        <statement format="setbit 1 5" />
        <statement format="getstat" />
      </session>
      <session id="chgfw" label="Charging Plug Forward">
        <statement format="setbit 1 6" />
        <statement format="getstat" />
      </session>
      <session id="chgbk" label="Charging Plug Backward">
        <statement format="setbit 1 7" />
        <statement format="getstat" />
      </session>
      <session id="pwoff" label="Outlet Power Off">
        <statement format="setbit 1 8" />
        <statement format="getstat" />
      </session>
      <session id="mhook" label="Movable Flange Hook">
        <statement format="setbit 2 0" />
        <statement format="getstat" />
      </session>
      <session id="munhk" label="Movable Flange UnHook">
        <statement format="setbit 2 1" />
        <statement format="getstat" />
      </session>
      <session id="mrotout" label="Movable Flange Rotation for Loading">
        <statement format="setbit 2 2" />
        <statement format="getstat" />
      </session>
      <session id="mrotin" label="Movable Flange Rotation for Storing">
        <statement format="setbit 2 3" />
        <statement format="getstat" />
      </session>
      <session id="mjup" label="Movable Flange Jack Up">
        <statement format="setbit 2 4" />
        <statement format="getstat" />
      </session>
      <session id="mjdw" label="Movable Flange Jack Down">
        <statement format="setbit 2 5" />
        <statement format="getstat" />
      </session>
      <session id="trout" label="Movable Flange Transer Out">
        <statement format="setbit 2 6" />
        <statement format="getstat" />
      </session>
      <session id="trin" label="Movable Flange Transer In">
        <statement format="setbit 2 7" />
        <statement format="getstat" />
      </session>
      <session id="dopen" label="Door Open">
        <statement format="setbit 3 0" />
        <statement format="getstat" />
      </session>
      <session id="dclose" label="Door Close">
        <statement format="setbit 3 1" />
        <statement format="getstat" />
      </session>
      <session id="fpwon" label="Fix Flange Instrument Power On">
        <statement format="setbit 3 2" />
        <statement format="getstat" />
      </session>
      <session id="fpwoff" label="Fix Flange Instrument Power Off">
        <statement format="setbit 3 3" />
        <statement format="getstat" />
      </session>
      <session id="mpwon" label="Movable Flange Instrument Power On">
        <statement format="setbit 3 4" />
        <statement format="getstat" />
      </session>
      <session id="mpwoff" label="Movable Flange Instrument Power Off">
        <statement format="setbit 3 5" />
        <statement format="getstat" />
      </session>
      <session id="fccdon" label="Fix Flange CCD Power On">
        <statement format="setbit 3 8" />
        <statement format="getstat" />
      </session>
      <session id="fccdoff" label="Fix Flange CCD Power Off">
        <statement format="setbit 3 9" />
        <statement format="getstat" />
      </session>
      <session id="fccdtoff" label="Fix Flange CCD Timer Off">
        <statement format="setbit 3 10" />
        <statement format="getstat" />
      </session>
      <session id="mccdon" label="Movable Flange CCD Power On">
        <statement format="setbit 3 12" />
        <statement format="getstat" />
      </session>
      <session id="mccdoff" label="Movable Flange CCD Power Off">
        <statement format="setbit 3 13" />
        <statement format="getstat" />
      </session>
      <session id="mccdtoff" label="Movable Flange CCD Timer Off">
        <statement format="setbit 3 14" />
        <statement format="getstat" />
      </session>
    </commands>
    <watch interval="1" xmlns="http://ciax.sum.naoj.org/ciax-xml/cdbw">
      <event label="Regular">
        <periodic period="300" />
        <command>upd</command>
      </event>
      <event blocking="[fmt].+" interrupt="pause" label="On Motion">
        <while ref="isu" val="1" />
        <command>upd</command>
      </event>
      <event label="On Completion">
        <onchange ref="cmp" val="1" />
        <command>clr</command>
        <command>upd</command>
      </event>
    </watch>
    <status xmlns="http://ciax.sum.naoj.org/ciax-xml/cdbs">
      <value format="%s" id="emg" label="GL:EMG STOP">
        <binary bit="0" ref="w:0" />
      </value>
      <value format="%s" id="pse" label="GL:PAUSE">
        <binary bit="1" ref="w:0" />
      </value>
      <value format="%s" id="rdy" label="GL:READY">
        <binary bit="3" ref="w:0" />
      </value>
      <value format="%s" id="cmp" label="GL:COMMAND COMPLETE">
        <binary bit="14" ref="w:0" />
      </value>
      <value format="%s" id="isu" label="GL:COMMAND ISSUED">
        <binary bit="15" ref="w:0" />
      </value>
      <value format="%s%s" id="ctl" label="GL:CONTROL">
        <binary bit="6" ref="w:0" />
        <binary bit="7" ref="w:0" />
      </value>
      <value format="%d" id="zerr" label="GL:Z SensorError">
        <int ref="zerr" />
      </value>
      <value format="%s%s" id="fhk" label="Fix Hook">
        <binary bit="0" ref="w:1" />
        <binary bit="1" ref="w:1" />
      </value>
      <value format="%s%s" id="fjk" label="Fix Jack">
        <binary bit="14" ref="w:1" />
        <binary bit="15" ref="w:1" />
      </value>
      <value format="%s%s" id="mhk" label="Mov Hook">
        <binary bit="0" ref="w:5" />
        <binary bit="1" ref="w:5" />
      </value>
      <value format="%s%s" id="mjk" label="Mov Jack">
        <binary bit="14" ref="w:5" />
        <binary bit="15" ref="w:5" />
      </value>
      <value format="%s%s" id="mrt" label="Mov Rotation">
        <binary bit="2" ref="w:5" />
        <binary bit="3" ref="w:5" />
      </value>
      <value format="%s%s" id="mtr" label="Mov Transer">
        <binary bit="8" ref="w:6" />
        <binary bit="6" ref="w:6" />
      </value>
      <value format="%s%s%s%s" id="fist" label="Fix Attach">
        <binary bit="0" ref="w:2" />
        <binary bit="1" ref="w:2" />
        <binary bit="2" ref="w:2" />
        <binary bit="3" ref="w:2" />
      </value>
      <value format="%s%s%s%s" id="mist" label="Mov Attach">
        <binary bit="0" ref="w:6" />
        <binary bit="1" ref="w:6" />
        <binary bit="2" ref="w:6" />
        <binary bit="3" ref="w:6" />
      </value>
      <value format="%s%s" id="chg" label="CHG Plug">
        <binary bit="6" ref="w:2" />
        <binary bit="7" ref="w:2" />
      </value>
      <value format="%s%s" id="door" label="Door">
        <binary bit="0" ref="w:9" />
        <binary bit="1" ref="w:9" />
      </value>
      <value format="%s" id="fipw" label="Fix Inst Power">
        <binary bit="8" ref="w:9" />
      </value>
      <value format="%s" id="fcpw" label="Fix CCD">
        <binary bit="10" ref="w:9" />
      </value>
      <value format="%s" id="mipw" label="Mov Inst Power">
        <binary bit="9" ref="w:9" />
      </value>
      <value format="%s" id="mcpw" label="Mov CCD">
        <binary bit="11" ref="w:9" />
      </value>
      <repeat from="1" to="4">
        <value format="%.2f" id="fz$_" label="Fix Z">
          <float formula="$#/100" ref="d:($_-1)" />
        </value>
      </repeat>
      <repeat from="1" to="4">
        <value format="%.2f" id="mz$_" label="Mov Z">
          <float formula="$#/100" ref="d:($_+3)" />
        </value>
      </repeat>
      <value format="%d" id="fiid" label="Fix Instrument ID">
        <int ref="d:8" />
      </value>
      <value format="%d" id="miid" label="Mov Instrument ID">
        <int ref="d:9" />
      </value>
    </status>
    <symbol xmlns="http://ciax.sum.naoj.org/ciax-xml/sdb">
      <enum id="emg" ref="alarm" />
      <enum id="pse" ref="warn" />
      <enum id="rdy" ref="off-warn" />
      <enum id="cmp" ref="normal" />
      <enum id="isu" ref="normal" />
      <enum id="ctl">
        <case class="normal" msg="AUTO">10</case>
        <case class="normal" msg="MANUAL">01</case>
        <case class="alarm" msg="N/A">00</case>
      </enum>
      <enum id="fhk" ref="hook" />
      <enum id="fjk" ref="jack" />
      <enum id="mhk" ref="hook" />
      <enum id="mjk" ref="jack" />
      <enum id="mrt" ref="rot" />
      <enum id="mtr" ref="mov" />
      <enum id="chg" ref="mov" />
      <enum id="hook">
        <case class="normal" msg="HOOK">10</case>
        <case class="normal" msg="UNHOOK">01</case>
        <case class="alarm" msg="N/A">00</case>
      </enum>
      <enum id="jack">
        <case class="normal" msg="UP">10</case>
        <case class="normal" msg="DW">01</case>
        <case class="alarm" msg="N/A">00</case>
      </enum>
      <enum id="mov">
        <case class="normal" msg="FW">10</case>
        <case class="normal" msg="BK">01</case>
        <case class="alarm" msg="N/A">00</case>
      </enum>
      <enum id="rot">
        <case class="normal" msg="LOAD">10</case>
        <case class="normal" msg="STORE">01</case>
        <case class="alarm" msg="N/A">00</case>
      </enum>
      <enum id="door">
        <case class="normal" msg="OPEN">10</case>
        <case class="normal" msg="CLOSE">01</case>
        <case class="alarm" msg="N/A">00</case>
      </enum>
      <enum id="fipw" ref="off-warn" />
      <enum id="fcpw" ref="off-warn" />
      <enum id="mipw" ref="off-warn" />
      <enum id="mcpw" ref="off-warn" />
      <enum id="fiid" ref="iid_ac" />
      <enum id="miid" ref="iid_ac" />
    </symbol>
  </class>
</cdb>