<?xml version="1.0" encoding="utf-8"?>
<adb xmlns="http://ciax.sum.naoj.org/ciax-xml/adb">
  <app frm_type="cj2" id="cj2" label="Stand-by Flange PLC">
    <commands xmlns="http://ciax.sum.naoj.org/ciax-xml/adbc">
      <command id="upd" label="Regular status update">
        <frmcmd name="getstat" />
        <frmcmd name="getcmd" />
        <frmcmd name="geterr" />
        <frmcmd name="getzlen" />
      </command>
      <command id="reset" label="ResetBit">
        <frmcmd name="clrbit" />
        <frmcmd name="getcmd" />
        <frmcmd name="getstat" />
      </command>
      <command id="stop" label="Emergency Stop">
        <frmcmd name="setbit">
          <argv>0</argv>
          <argv>0</argv>
        </frmcmd>
        <frmcmd name="clrbit" />
        <frmcmd name="getstat" />
      </command>
      <command id="pause" label="Pause">
        <frmcmd name="setbit">
          <argv>0</argv>
          <argv>1</argv>
        </frmcmd>
        <frmcmd name="clrbit" />
        <frmcmd name="getstat" />
      </command>
      <command id="resume" label="Resume Pause">
        <frmcmd name="setbit">
          <argv>0</argv>
          <argv>10</argv>
        </frmcmd>
        <frmcmd name="clrbit" />
        <frmcmd name="getstat" />
      </command>
      <command id="reserr" label="Reset Error">
        <frmcmd name="setbit">
          <argv>0</argv>
          <argv>11</argv>
        </frmcmd>
        <frmcmd name="clrbit" />
        <frmcmd name="getstat" />
        <frmcmd name="geterr" />
      </command>
      <command id="ready" label="Drive Ready">
        <frmcmd name="setbit">
          <argv>0</argv>
          <argv>3</argv>
        </frmcmd>
        <frmcmd name="clrbit" />
        <frmcmd name="getstat" />
      </command>
      <command id="fhook" label="Fix Flange Hook">
        <frmcmd name="setbit">
          <argv>1</argv>
          <argv>0</argv>
        </frmcmd>
        <frmcmd name="getcmd" />
      </command>
      <command id="funhk" label="Fix Flange UnHook">
        <frmcmd name="setbit">
          <argv>1</argv>
          <argv>1</argv>
        </frmcmd>
        <frmcmd name="getcmd" />
      </command>
      <command id="fjup" label="Fix Flange Jack Up">
        <frmcmd name="setbit">
          <argv>1</argv>
          <argv>4</argv>
        </frmcmd>
        <frmcmd name="getcmd" />
      </command>
      <command id="fjdw" label="Fix Flange Jack Down">
        <frmcmd name="setbit">
          <argv>1</argv>
          <argv>5</argv>
        </frmcmd>
        <frmcmd name="getcmd" />
      </command>
      <command id="chgfw" label="Charging Plug Forward">
        <frmcmd name="setbit">
          <argv>1</argv>
          <argv>6</argv>
        </frmcmd>
        <frmcmd name="getcmd" />
      </command>
      <command id="chgbk" label="Charging Plug Backward">
        <frmcmd name="setbit">
          <argv>1</argv>
          <argv>7</argv>
        </frmcmd>
        <frmcmd name="getcmd" />
      </command>
      <command id="pwoff" label="Outlet Power Off">
        <frmcmd name="setbit">
          <argv>1</argv>
          <argv>8</argv>
        </frmcmd>
        <frmcmd name="getstat" />
      </command>
      <command id="mhook" label="Mov Flange Hook">
        <frmcmd name="setbit">
          <argv>2</argv>
          <argv>0</argv>
        </frmcmd>
        <frmcmd name="getcmd" />
      </command>
      <command id="munhk" label="Mov Flange UnHook">
        <frmcmd name="setbit">
          <argv>2</argv>
          <argv>1</argv>
        </frmcmd>
        <frmcmd name="getcmd" />
      </command>
      <command id="mrotout" label="Mov Flange Rotation for Loading">
        <frmcmd name="setbit">
          <argv>2</argv>
          <argv>2</argv>
        </frmcmd>
        <frmcmd name="getcmd" />
      </command>
      <command id="mrotin" label="Mov Flange Rotation for Storing">
        <frmcmd name="setbit">
          <argv>2</argv>
          <argv>3</argv>
        </frmcmd>
        <frmcmd name="getcmd" />
      </command>
      <command id="mjup" label="Mov Flange Jack Up">
        <frmcmd name="setbit">
          <argv>2</argv>
          <argv>4</argv>
        </frmcmd>
        <frmcmd name="getcmd" />
      </command>
      <command id="mjdw" label="Mov Flange Jack Down">
        <frmcmd name="setbit">
          <argv>2</argv>
          <argv>5</argv>
        </frmcmd>
        <frmcmd name="getcmd" />
      </command>
      <command id="trout" label="Mov Flange Transer Out">
        <frmcmd name="setbit">
          <argv>2</argv>
          <argv>6</argv>
        </frmcmd>
        <frmcmd name="getcmd" />
      </command>
      <command id="trin" label="Mov Flange Transer In">
        <frmcmd name="setbit">
          <argv>2</argv>
          <argv>7</argv>
        </frmcmd>
        <frmcmd name="getcmd" />
      </command>
      <command id="dopen" label="Door Open">
        <frmcmd name="setbit">
          <argv>3</argv>
          <argv>0</argv>
        </frmcmd>
        <frmcmd name="getcmd" />
      </command>
      <command id="dclose" label="Door Close">
        <frmcmd name="setbit">
          <argv>3</argv>
          <argv>1</argv>
        </frmcmd>
        <frmcmd name="getcmd" />
      </command>
      <command id="fpwon" label="Fix Flange Instrument Power On">
        <frmcmd name="setbit">
          <argv>3</argv>
          <argv>2</argv>
        </frmcmd>
        <frmcmd name="getcmd" />
      </command>
      <command id="fpwoff" label="Fix Flange Instrument Power Off">
        <frmcmd name="setbit">
          <argv>3</argv>
          <argv>3</argv>
        </frmcmd>
        <frmcmd name="getcmd" />
      </command>
      <command id="mpwon" label="Mov Flange Instrument Power On">
        <frmcmd name="setbit">
          <argv>3</argv>
          <argv>4</argv>
        </frmcmd>
        <frmcmd name="getstat" />
      </command>
      <command id="mpwoff" label="Mov Flange Instrument Power Off">
        <frmcmd name="setbit">
          <argv>3</argv>
          <argv>5</argv>
        </frmcmd>
        <frmcmd name="getcmd" />
      </command>
      <command id="fccdon" label="Fix Flange CCD Power On">
        <frmcmd name="setbit">
          <argv>3</argv>
          <argv>8</argv>
        </frmcmd>
        <frmcmd name="getcmd" />
      </command>
      <command id="fccdoff" label="Fix Flange CCD Power Off">
        <frmcmd name="setbit">
          <argv>3</argv>
          <argv>9</argv>
        </frmcmd>
        <frmcmd name="getcmd" />
      </command>
      <command id="fccdtoff" label="Fix Flange CCD Timer Off">
        <frmcmd name="setbit">
          <argv>3</argv>
          <argv>10</argv>
        </frmcmd>
        <frmcmd name="getcmd" />
      </command>
      <command id="mccdon" label="Mov Flange CCD Power On">
        <frmcmd name="setbit">
          <argv>3</argv>
          <argv>12</argv>
        </frmcmd>
        <frmcmd name="getcmd" />
      </command>
      <command id="mccdoff" label="Mov Flange CCD Power Off">
        <frmcmd name="setbit">
          <argv>3</argv>
          <argv>13</argv>
        </frmcmd>
        <frmcmd name="getcmd" />
      </command>
      <command id="mccdtoff" label="Mov Flange CCD Timer Off">
        <frmcmd name="setbit">
          <argv>3</argv>
          <argv>14</argv>
        </frmcmd>
        <frmcmd name="getcmd" />
      </command>
    </commands>
    <status xmlns="http://ciax.sum.naoj.org/ciax-xml/adbs" table="cj2">
      <group id="g1" label="MAIN">
        <row label="General">
          <value id="ctl" label="CONTROL" symbol="ctl">
            <binary bit="6" ref="w:0" />
            <binary bit="7" ref="w:0" />
          </value>
          <value id="pse" label="PAUSE" symbol="warn">
            <binary bit="1" ref="w:0" />
          </value>
          <value id="rdy" label="READY" symbol="off-warn">
            <binary bit="3" ref="w:0" />
          </value>
        </row>
        <row>
          <value id="err" label="ERROR CODE" symbol="err">
            <int ref="err" />
          </value>
          <value id="emg" label="EMG STOP" symbol="alarm">
            <binary bit="0" ref="w:0" />
          </value>
        </row>
      </group>
      <group id="g2" label="ACTION STAT">
        <row>
          <value id="exe" label="EXECUTING" symbol="exe">
            <int ref="c:0" />
            <int ref="c:1" />
            <int ref="c:2" />
            <int ref="c:3" />
          </value>
          <value id="run" label="RUNNING" symbol="warn">
            <binary bit="15" ref="w:0" />
          </value>
          <value id="cmp" label="COMPLETE" symbol="warn">
            <binary bit="14" ref="w:0" />
          </value>
        </row>
      </group>
      <group id="g3" label="FIX Flange">
        <row label="Fix Jack Bolt">
          <value id="fis" label="Attach" symbol="ist">
            <binary bit="0" ref="w:2" />
            <binary bit="1" ref="w:2" />
            <binary bit="2" ref="w:2" />
            <binary bit="3" ref="w:2" />
          </value>
          <value id="fhk" label="Hook" symbol="hook">
            <binary bit="0" ref="w:1" />
            <binary bit="1" ref="w:1" />
          </value>
          <value id="fjb" label="Jack Bolt" symbol="jack">
            <binary bit="14" ref="w:1" />
            <binary bit="15" ref="w:1" />
          </value>
        </row>
        <row label="Fix Power Status" width="3">
          <value id="fpw" label="Inst Power" symbol="off-warn">
            <binary bit="8" ref="w:9" />
          </value>
          <value id="fph" label="PW Phase" symbol="rst">
            <binary bit="0" ref="w:10" />
            <binary bit="1" ref="w:10" />
            <binary bit="2" ref="w:10" />
          </value>
          <value id="fcc" label="CCD Power" symbol="off-warn">
            <binary bit="10" ref="w:9" />
          </value>
        </row>
      </group>
      <group id="g4" label="MOV Flange">
        <row label="Mov Jack Bolt">
          <value id="mis" label="Attach" symbol="ist">
            <binary bit="0" ref="w:6" />
            <binary bit="1" ref="w:6" />
            <binary bit="2" ref="w:6" />
            <binary bit="3" ref="w:6" />
          </value>
          <value id="mhk" label="Hook" symbol="hook">
            <binary bit="0" ref="w:5" />
            <binary bit="1" ref="w:5" />
          </value>
          <value id="mjb" label="Jack Bolt" symbol="jack">
            <binary bit="14" ref="w:5" />
            <binary bit="15" ref="w:5" />
          </value>
        </row>
        <row label="Mov Transer">
          <value id="mrt" label="Rotation" symbol="rot">
            <binary bit="2" ref="w:5" />
            <binary bit="3" ref="w:5" />
          </value>
          <value id="mtr" label="Transer" symbol="mov">
            <binary bit="8" ref="w:6" />
            <binary bit="6" ref="w:6" />
          </value>
        </row>
        <row label="Mov Power Status" width="3">
          <value id="mpw" label="Inst Power" symbol="off-warn">
            <binary bit="9" ref="w:9" />
          </value>
          <value id="mph" label="PW Phase" symbol="rst">
            <binary bit="8" ref="w:10" />
            <binary bit="9" ref="w:10" />
            <binary bit="10" ref="w:10" />
          </value>
          <value id="mcc" label="CCD Power" symbol="off-warn">
            <binary bit="11" ref="w:9" />
          </value>
        </row>
      </group>
      <group id="g5" label="Z Sensor">
        <row>
          <repeat from="1" to="4">
            <value id="fz%d" label="Fix %d" format="%.2f">
              <float ref="d" index="$_-1" formula="$#/100" />
            </value>
          </repeat>
        </row>
        <row>
          <repeat from="1" to="4">
            <value id="mz%d" label="Mov %d" format="%.2f">
              <float ref="d" index="$_+3" formula="$#/100" />
            </value>
          </repeat>
        </row>
      </group>
      <group id="g6" label="Instrument">
        <row label="Instrument ID">
          <value id="fid" label="Fix Instrument ID" symbol="iid_ac">
            <int ref="d:8" />
          </value>
          <value id="mid" label="Mov Instrument ID" symbol="iid_ac">
            <int ref="d:9" />
          </value>
        </row>
      </group>
      <group id="g7" label="Charging">
        <row label="Charging">
          <value id="chg" label="CHG Plug" symbol="mov">
            <binary bit="6" ref="w:2" />
            <binary bit="7" ref="w:2" />
          </value>
          <value id="ccn" label="CHG Connect" symbol="off-warn">
            <binary bit="8" ref="w:4" />
          </value>
          <value id="cpw" label="CHG Power" symbol="off-warn">
            <binary bit="12" ref="w:4" />
          </value>
          <value id="dor" label="Door" symbol="dor">
            <binary bit="0" ref="w:9" />
            <binary bit="1" ref="w:9" />
          </value>
        </row>
      </group>
    </status>
    <watch xmlns="http://ciax.sum.naoj.org/ciax-xml/wdb" interval="1">
      <event label="Regular">
        <range ref="elapse">300:</range>
        <exec name="upd"></exec>
      </event>
      <event label="On Motion">
        <range ref="exe">0&lt;:</range>
        <block name="fhook"></block>
        <block name="funhk"></block>
        <block name="fjup"></block>
        <block name="fjdw"></block>
        <block name="mhook"></block>
        <block name="munhk"></block>
        <block name="mjup"></block>
        <block name="mjdw"></block>
        <block name="trin"></block>
        <block name="trout"></block>
        <block name="dopen"></block>
        <block name="dclose"></block>
        <int name="pause" />
        <exec name="upd"></exec>
      </event>
      <event label="On Completion">
        <onchange ref="cmp"></onchange>
        <pattern ref="cmp">1</pattern>
        <exec name="reset"></exec>
      </event>
    </watch>
  </app>
</adb>