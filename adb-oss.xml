<?xml version="1.0" encoding="utf-8"?>
<adb xmlns="http://ciax.sum.naoj.org/ciax-xml/adb">
  <app frm_type="oss" id="oss" label="TSC Control" version="2">
    <commands xmlns="http://ciax.sum.naoj.org/ciax-xml/adbc">
      <group id="g0" caption="Device">
        <command id="upd" label="Update Status">
          <frmcmd name="logstat" />
          <frmcmd name="getstat" />
          <frmcmd name="iststat" />
          <frmcmd name="jakstat" />
          <frmcmd name="inrstat" />
        </command>
        <command id="login" label="Login">
          <frmcmd name="login" />
          <frmcmd name="logstat" />
        </command>
        <command id="logout" label="Logout">
          <frmcmd name="logout" />
          <frmcmd name="logstat" />
        </command>
        <command id="init" label="Start TCP Status Request">
          <frmcmd name="init" />
        </command>
        <command id="startup" label="Start Up CIAX operation">
          <frmcmd name="login" />
          <frmcmd name="tsconly" label="TSC Only Mode(CIAX Mode)" />
          <frmcmd name="ron" />
          <frmcmd name="jon" />
        </command>
        <command id="shutdown" label="Shutdown CIAX operation">
          <frmcmd name="joff" />
          <frmcmd name="roff" />
          <frmcmd name="tscpri" label="TSC Primaly Mode" />
          <frmcmd name="logout" />
        </command>
        <command id="rhook" label="InR Hook">
          <frmcmd name="rhook" />
          <frmcmd name="inrstat" />
        </command>
        <command id="runhk" label="InR UnHook">
          <frmcmd name="runhk" />
          <frmcmd name="inrstat" />
        </command>
        <command id="rstop" label="InR Stop">
          <frmcmd name="rstop" />
          <frmcmd name="inrstat" />
        </command>
        <command id="jup" label="All EJB Up">
          <frmcmd name="ajup" />
          <frmcmd name="jakstat" />
        </command>
        <command id="jdw" label="All EJB Down">
          <frmcmd name="ajdw" />
          <frmcmd name="jakstat" />
        </command>
        <command id="jstop" label="All EJB Stop">
          <frmcmd name="ajstop" />
          <frmcmd name="jakstat" />
        </command>
        <command id="moircs" label="Set IID MOIRCS">
          <frmcmd name="setinst">
            <argv>12</argv>
          </frmcmd>
          <frmcmd name="iststat" />
        </command>
        <command id="focas" label="Set IID FOCAS">
          <frmcmd name="setinst">
            <argv>5</argv>
          </frmcmd>
          <frmcmd name="iststat" />
        </command>
        <command id="comics" label="Set IID COMICS">
          <frmcmd name="setinst">
            <argv>7</argv>
          </frmcmd>
          <frmcmd name="iststat" />
        </command>
        <command id="updjak" label="Update Jak Status" hidden="true">
          <frmcmd name="jakstat" />
          <frmcmd name="getexit" />
          <frmcmd name="getpid" />
        </command>
        <command id="updinr" label="Update Inr Status" hidden="true">
          <frmcmd name="inrstat" />
          <frmcmd name="getexit" />
          <frmcmd name="getpid" />
        </command>
      </group>
    </commands>
    <status xmlns="http://ciax.sum.naoj.org/ciax-xml/adbs" table="oss">
      <group id="g1" caption="Main" column="3">
        <integer id="exit" label="Exit Code">
          <field ref="exit" />
        </integer>
        <binary id="nfb" label="BOLT NFB TRIP">
          <normal bit="6" ref="bstat" />
        </binary>
        <string id="login" label="Login Status" symbol="login">
          <field ref="login0" />
          <field ref="login1" />
          <field ref="login2" />
          <field ref="login3" />
        </string>
        <integer id="rts" label="ROT SEL" symbol="rts">
          <field ref="rsel" />
        </integer>
        <integer id="iid" label="CAS INST ID" symbol="iid">
          <field ref="iid" />
        </integer>
      </group>
      <group id="g2" caption="Drive Stat" column="4">
        <binary id="azd" label="AZ" symbol="drv">
          <normal label="ON" bit="0" ref="teldrive" />
          <normal label="OFF" bit="1" ref="teldrive" />
          <normal label="Ready" bit="2" ref="teldrive" />
        </binary>
        <binary id="eld" label="EL" symbol="drv">
          <normal label="ON" bit="3" ref="teldrive" />
          <normal label="OFF" bit="4" ref="teldrive" />
          <normal label="Ready" bit="5" ref="teldrive" />
        </binary>
        <integer id="rpw" label="ROT" symbol="rpw">
          <field ref="rpw" />
        </integer>
        <binary id="jpw" label="JAK" symbol="warn">
          <normal bit="7" ref="bstat" />
        </binary>
      </group>
      <group id="g3" caption="Position" column="4">
        <binary id="stw" label="EL STOW" symbol="off-warn">
          <normal bit="2" ref="stow_1" />
        </binary>
        <float id="elv" label="EL" format="%.3f">
          <field ref="el" />
        </float>
        <float id="iang" label="InR" format="%.3f">
          <field ref="iang" />
        </float>
        <float id="jkm" label="JACK LEN" format="%.3f" formula="$#/1600">
          <repeat_val from="0" to="15">
            <field ref="jk" index="$_" />
          </repeat_val>
        </float>
        <binary id="abs" label="JACK STOP" symbol="warn">
          <normal ref="abs" bit="2" />
        </binary>
        <binary id="abc" label="JACK CLMP" symbol="warn">
          <normal ref="abs" bit="0" />
        </binary>
        <binary id="abr" label="JACK RDY" symbol="warn">
          <normal ref="abs" bit="4" />
        </binary>
        <binary id="rps" label="ROT SENSOR" symbol="rps">
          <normal bit="4" ref="bstat" />
          <normal bit="5" ref="bstat" />
        </binary>
      </group>
      <group id="g4" caption="[Stop] [Clmp] [Rdy] [Pos] [Jack Len]  [Clnt Lmt] [Alm]" column="7">
        <repeat from="1" to="16" format="%02d">
          <!--Order:1,0;3,2;5,4;7,6;...-->
          <binary id="bs$_" symbol="warn" label="$_">
            <normal ref="bs" index="$_-($_+1)%2*2" bit="2" />
          </binary>
          <binary id="bc$_" label="$_" symbol="warn">
            <normal ref="bs" index="$_-($_+1)%2*2" bit="0" />
          </binary>
          <binary id="br$_" label="$_" symbol="warn">
            <normal ref="bs" bit="3" index="$_-($_+1)%2*2" />
          </binary>
          <binary id="bl$_" label="$_" symbol="bl">
            <normal ref="bl" index="$_-($_+1)%2*2" bit="1" />
            <normal ref="bl" bit="2" index="$_-($_+1)%2*2" />
          </binary>
          <float id="jk$_" label="$_" format="%5.2f" formula="$#/100">
            <field ref="jk" index="$_-($_+1)%2*2" />
          </float>
          <binary id="cl$_" label="$_" symbol="normal">
            <normal ref="clm" index="1-($_-1)/8" bit="($_-1)%8" />
          </binary>
          <binary id="ba$_" label="$_" symbol="ba">
            <normal ref="bl" index="$_-($_+1)%2*2" bit="0"></normal>
            <normal ref="bl" index="$_-($_+1)%2*2" bit="4" />
          </binary>
        </repeat>
      </group>
      <group id="g5" caption="[Z Sensor Len]" column="4">
        <repeat from="1" to="4">
          <float id="z$_" label="$_" format="%5.2f" formula="$#/100">
            <field ref="zp" index="$_-1" />
          </float>
        </repeat>
      </group>
    </status>
    <watch interval="1" xmlns="http://ciax.sum.naoj.org/ciax-xml/wdb">
      <event label="Moving Jack" id="jak">
        <onchange var="jkm"></onchange>
        <block name="jup"></block>
        <block name="jdw"></block>
        <int name="jstop" />
        <exec name="updjak"></exec>
      </event>
      <event label="Moving InR" id="inr">
        <onchange var="iang"></onchange>
        <block name="rhook"></block>
        <block name="runhk"></block>
        <int name="rstop" />
        <exec name="updinr"></exec>
      </event>
    </watch>
  </app>
</adb>
