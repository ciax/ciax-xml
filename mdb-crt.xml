<?xml version="1.0" encoding="iso-8859-1"?>
<mdb xmlns="http://ciax.sum.naoj.org/ciax-xml" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://ciax.sum.naoj.org/ciax-xml/schema/mdb.xsd">
  <macro_group id="crt" class="crt" label="Cart Macro">
    <macro id="runf" label="Run Forward to Tag">
      <break label="On Tag?">
        <item ref="cpos" field="val">^0</item>
      </break>
      <check>
        <item ref="rdy" field="val">1</item>
      </check>
      <session>set_fwd</session>
      <session>run_start</session>
      <wait timeout="1" update="upd_all">
        <break combination="and">
          <item ref="run" field="val">1</item>
        </break>
      </wait>
      <session>clear</session>
      <wait timeout="40" abort="pause" update="upd_all">
        <break>
          <item ref="run" field="val">0</item>
        </break>
      </wait>
      <check>
        <item ref="cpos" field="val">^0</item>
      </check>
    </macro>
    <macro id="runto" label="Run to Tag 1">
      <break label="On Tag1 ?">
        <item ref="cpos" field="val">1</item>
      </break>
      <check>
        <item ref="rdy" field="val">1</item>
      </check>
      <session>set_tag</session>
      <session>run_start</session>
      <wait timeout="1" update="upd_all">
        <break combination="and">
          <item ref="run" field="val">1</item>
        </break>
      </wait>
      <session>clear</session>
      <wait timeout="40" abort="pause" update="upd_all">
        <break>
          <item ref="run" field="val">0</item>
        </break>
      </wait>
      <check label="On Tag1 ?">
        <item ref="cpos" field="val">1</item>
      </check>
    </macro>
    <macro id="jak1" label="Jack UP Level 1">
      <commandset>
        <command label="Set Level 1">
          <text>set_level</text>
          <text>0200</text>
        </command>
        <command label="Jacking Start">
          <text>start</text>
          <text>0001</text>
        </command>
        <wait_until var="jak" value="1" timeout="1">
          <command>
            <text>getstat</text>
          </command>
        </wait_until>
        <command abort="stop" label="Clear Triggers">
          <text>clear</text>
        </command>
        <wait_until var="jak" value="0" timeout="30">
          <command>
            <text>getstat</text>
          </command>
        </wait_until>
      </commandset>
      <interlock>
        <sufficient var="jpos" value="1" />
        <required var="rdy" value="1" />
      </interlock>
    </macro>
    <macro id="pause" label="Pause">
      <commandset>
        <command>
          <text>stop</text>
        </command>
        <command>
          <text>0100</text>
        </command>
      </commandset>
    </macro>
    <macro id="emstop" label="Emergency Stop">
      <commandset>
        <command>
          <text>stop</text>
        </command>
        <command>
          <text>0200</text>
        </command>
      </commandset>
    </macro>
    <macro id="resume" label="Resume from Pause">
      <commandset>
        <command>
          <text>clear</text>
        </command>
      </commandset>
    </macro>
  </macro_group>
</mdb>