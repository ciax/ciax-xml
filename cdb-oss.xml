<?xml version="1.0" encoding="utf-8"?>
<cdb xsi:schemaLocation="http://ciax.sum.naoj.org/ciax-xml/schema/cdb.xsd" xmlns="http://ciax.sum.naoj.org/ciax-xml/cdb" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
  <class frame="oss" id="oss" label="TSC Control">
    <commands xmlns="http://ciax.sum.naoj.org/ciax-xml/cdbc">
      <session id="upd" label="Update Status">
        <statement command="logstat" />
        <statement command="getstat" />
        <statement command="iststat" />
        <statement command="jakstat" />
        <statement command="inrstat" />
      </session>
      <session id="login" label="Login">
        <statement command="login" />
        <statement command="logstat" />
      </session>
      <session id="logout" label="Logout">
        <statement command="logout" />
        <statement command="logstat" />
      </session>
      <session id="init" label="Start TCP Status Request">
        <statement command="init" />
      </session>
      <session id="startup" label="Start Up CIAX operation">
        <statement command="login" />
        <statement command="tsconly" label="TSC Only Mode(CIAX Mode)" />
        <statement command="ron" />
        <statement command="jon" />
      </session>
      <session id="shutdown" label="Shutdown CIAX operation">
        <statement command="joff" />
        <statement command="roff" />
        <statement command="tscpri" label="TSC Primaly Mode" />
        <statement command="logout" />
      </session>
      <session id="rhook" label="InR Hook">
        <statement command="rhook" />
        <statement command="inrstat" />
      </session>
      <session id="runhk" label="InR UnHook">
        <statement command="runhk" />
        <statement command="inrstat" />
      </session>
      <session id="rstop" label="InR Stop">
        <statement command="rstop" />
        <statement command="inrstat" />
      </session>
      <session id="jup" label="All EJB Up">
        <statement command="ajup" />
        <statement command="jakstat" />
      </session>
      <session id="jdw" label="All EJB Down">
        <statement command="ajdw" />
        <statement command="jakstat" />
      </session>
      <session id="jstop" label="All EJB Stop">
        <statement command="jstop" />
        <statement command="jakstat" />
      </session>
      <session id="moircs" label="Set IID MOIRCS">
        <statement command="setinst">
          <argv>12</argv>
        </statement>
        <statement command="iststat" />
      </session>
      <session id="focas" label="Set IID FOCAS">
        <statement command="setinst">
          <argv>5</argv>
        </statement>
        <statement command="iststat" />
      </session>
      <session id="comics" label="Set IID COMICS">
        <statement command="setinst">
          <argv>7</argv>
        </statement>
        <statement command="iststat" />
      </session>
    </commands>
    <watch interval="1" xmlns="http://ciax.sum.naoj.org/ciax-xml/wdb">
      <onchange label="Moving Jack" ref="jk1">
        <blocking>jup|jdw</blocking>
        <interrupt command="jstop" />
        <statement command="jakstat" />
        <statement command="getexit" />
        <statement command="getpid" />
      </onchange>
      <onchange label="Moving InR" ref="iang">
        <blocking>rhook|runhk</blocking>
        <interrupt command="rstop" />
        <statement command="inrstat" />
        <statement command="getexit" />
        <statement command="getpid" />
      </onchange>
    </watch>
    <status xmlns="http://ciax.sum.naoj.org/ciax-xml/cdbs">
      <value id="exit" label="Exit Code" group="1">
        <int ref="exit" />
      </value>
      <value id="rts" label="ROT SEL" group="1">
        <int ref="rsel" />
      </value>
      <value id="iid" label="CAS INST ID" group="1">
        <int ref="iid" />
      </value>
      <value id="login" label="Login Status" group="1">
        <string ref="login0" />
        <string ref="login1" />
        <string ref="login2" />
        <string ref="login3" />
      </value>
      <value id="rpw" label="ROT DRIVE" group="2">
        <int ref="rpw" />
      </value>
      <value id="jpw" label="JAK DRIVE" group="2">
        <binary bit="7" ref="bstat" />
      </value>
      <value id="nfb" label="BOLT NFB TRIP" group="3">
        <binary bit="6" ref="bstat" />
      </value>
      <value id="rps" label="ROT POS SENSOR" group="3">
        <binary bit="4" ref="bstat" />
        <binary bit="5" ref="bstat" />
      </value>
      <value id="stw" label="EL STOW" group="4">
        <binary bit="2" ref="stow_1" />
      </value>
      <value id="stp" label="EL 90 STOW" group="4">
        <binary bit="0" ref="stow_1" />
      </value>
      <value id="iang" label="InR Angle" group="4">
        <float ref="iang" />
      </value>
      <repeat from="0" to="15">
        <value id="jk$_" label="Jack Pulse $_">
          <int ref="jk:$_" />
        </value>
      </repeat>
    </status>
    <symbol xmlns="http://ciax.sum.naoj.org/ciax-xml/sdb">
      <case id="rts" class="alarm" msg="N/A">
        <enum class="warn" msg="PFO">1</enum>
        <enum class="warn" msg="PFI">2</enum>
        <enum class="normal" msg="CAS">4</enum>
        <enum class="warn" msg="NSO">8</enum>
        <enum class="warn" msg="NSI">10</enum>
      </case>
      <case id="iid" msg="N/A">
        <enum class="warn" msg="NONE">0</enum>
        <enum class="normal" msg="IRCS">1</enum>
        <enum class="normal" msg="CIAO">3</enum>
        <enum class="normal" msg="FOCAS">5</enum>
        <enum class="normal" msg="COMICS">7</enum>
        <enum class="normal" msg="K3D">10</enum>
        <enum class="normal" msg="MOIRCS">12</enum>
        <enum class="normal" msg="CIAX3">13</enum>
      </case>
      <case id="login" class="warn" msg="LOGOUT">
        <regexp class="alarm" msg="OSS Login">OSS</regexp>
        <regexp class="normal" msg="LOGIN">CXWS</regexp>
      </case>
      <case id="rpw">
        <enum class="warn" msg="ON">1</enum>
        <enum class="normal" msg="OFF">2</enum>
      </case>
      <case id="rps" class="alarm" msg="N/A">
        <enum class="normal" msg="OFF">11</enum>
        <enum class="normal" msg="0DEG">10</enum>
        <enum class="normal" msg="-4DEG">01</enum>
      </case>
    </symbol>
  </class>
</cdb>