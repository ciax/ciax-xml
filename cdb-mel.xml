<?xml version="1.0" encoding="utf-8"?>
<cdb xsi:schemaLocation="http://ciax.sum.naoj.org/ciax-xml/schema/cdb.xsd" xmlns="http://ciax.sum.naoj.org/ciax-xml/cdb" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
  <class frame="mel" id="mel" label="Cart PLC">
    <commands xmlns="http://ciax.sum.naoj.org/ciax-xml/cdbc">
      <session id="upd" label="Regular status update">
        <statement command="getstat" />
        <statement command="chken" />
      </session>
      <session id="start_run" label="Running Start">
        <statement command="start">
          <argv>1</argv>
        </statement>
      </session>
      <session id="start_jak" label="Jacking Start">
        <statement command="start">
          <argv format="%d">0x100</argv>
        </statement>
      </session>
      <session id="clear_trg" label="Clear Trigger">
        <statement command="clear" />
      </session>
      <session id="set_tag" label="Set Destination Tag [1-12]">
        <parameters>
          <par validate="range">1:12</par>
        </parameters>
        <statement command="set_tag">
          <argv>$1</argv>
        </statement>
      </session>
      <session id="set_jak" label="Set Jack Level [0-3]">
        <parameters>
          <par validate="range">0:3</par>
        </parameters>
        <statement command="set_pos">
          <argv>$1</argv>
        </statement>
      </session>
      <session id="run" label="Run to Destination Tag [1-12]">
        <parameters>
          <par validate="range">1:12</par>
        </parameters>
        <statement command="set_tag">
          <argv>$1</argv>
        </statement>
        <statement command="start">
          <argv>1</argv>
        </statement>
      </session>
      <session id="fwd" label="Run Forward">
        <statement command="set_tag">
          <argv>98</argv>
        </statement>
        <statement command="start">
          <argv>1</argv>
        </statement>
      </session>
      <session id="bak" label="Run Backword">
        <statement command="set_tag">
          <argv>99</argv>
        </statement>
        <statement command="start">
          <argv>1</argv>
        </statement>
      </session>
      <session id="lift" label="Lift Jack Level [0-3]">
        <parameters>
          <par validate="range">0:3</par>
        </parameters>
        <statement command="set_pos">
          <argv>$1</argv>
        </statement>
        <statement command="start">
          <argv format="%d">0x100</argv>
        </statement>
      </session>
      <session id="pause" label="Pause">
        <statement command="stop">
          <argv>0</argv>
        </statement>
      </session>
      <session id="emstop" label="Emergency Stop">
        <statement command="stop">
          <argv>1</argv>
        </statement>
      </session>
      <session id="resume" label="Resume from Pause">
        <statement command="clear" />
      </session>
      <session id="get_tbl" label="Get Jack Table">
        <repeat counter="t" from="0" to="5">
          <repeat counter="j" from="0" to="3">
            <statement command="get_tbl">
              <argv>$t</argv>
              <argv>$j</argv>
            </statement>
          </repeat>
        </repeat>
      </session>
      <session id="set_tbl" label="Set Jack Table">
        <repeat counter="t" from="0" to="5">
          <repeat counter="j" from="0" to="3">
            <statement command="set_tbl">
              <argv>$t</argv>
              <argv>$j</argv>
            </statement>
          </repeat>
        </repeat>
      </session>
      <session id="tbl_read" label="Read to Buffer">
        <statement command="tbl_rw">
          <argv>1</argv>
        </statement>
      </session>
      <session id="tbl_write" label="Write from Buffer">
        <statement command="tbl_rw">
          <argv>0</argv>
        </statement>
      </session>
    </commands>
    <watch xmlns="http://ciax.sum.naoj.org/ciax-xml/cdbw" interval="1">
      <event>
        <periodic period="3600" />
        <command>upd</command>
      </event>
      <event>
        <onchange ref="run" val="1" />
        <command>clear_trig</command>
      </event>
      <event>
        <onchange ref="jak" val="1" />
        <command>clear_trig</command>
      </event>
    </watch>
    <status xmlns="http://ciax.sum.naoj.org/ciax-xml/cdbs">
      <value id="ecode" label="EXIT CODE" group="1">
        <int format="%04X" ref="ecode" />
      </value>
      <value id="rdy" label="READY" group="1">
        <binary bit="0" ref="x:0" />
      </value>
      <value id="pse" label="PAUSE" group="1">
        <binary bit="1" ref="x:0" />
      </value>
      <value id="emg" label="ENERGENCY" group="1">
        <binary bit="2" ref="x:0" />
      </value>
      <value id="stp" label="STOP" group="1">
        <binary bit="3" ref="x:0" />
      </value>
      <value id="run" label="RUNNING" group="2">
        <binary bit="4" ref="x:0" />
      </value>
      <value id="jak" label="JACKING" group="2">
        <binary bit="5" ref="x:0" />
      </value>
      <value id="con" label="CHARGING" group="2">
        <binary bit="6" ref="x:0" />
      </value>
      <value id="flt" label="Fault" group="2">
        <binary bit="7" ref="x:0" />
      </value>
      <value id="msr" label="Right Motor Servo" group="ms">
        <binary bit="8" inv="true" ref="x:0" />
      </value>
      <value id="msl" label="Left Motor Servo" group="ms">
        <binary bit="9" inv="true" ref="x:0" />
      </value>
      <value id="jd1" label="Jack Motor Servo1" group="j1">
        <binary bit="10" inv="true" ref="x:0" />
      </value>
      <value id="jd2" label="Jack Motor Servo2" group="j1">
        <binary bit="11" inv="true" ref="x:0" />
      </value>
      <value id="jd3" label="Jack Motor Servo3" group="j2">
        <binary bit="12" inv="true" ref="x:0" />
      </value>
      <value id="jd4" label="Jack Motor Servo4" group="j2">
        <binary bit="13" inv="true" ref="x:0" />
      </value>
      <value id="mdar" label="Rignt Motor D/A" group="da">
        <int ref="x:7" signed="true" />
      </value>
      <value id="mdal" label="Left Motor D/A" group="da">
        <int ref="x:8" signed="true" />
      </value>
      <value id="bvl" label="Battery Voltage" group="bv">
        <float decimal="2" format="%2.2f" ref="x:22" />
      </value>
      <value id="ist" label="Instrument" group="bv">
        <int ref="x:23" />
      </value>
      <value id="cpos" label="Current Position" group="pos">
        <int ref="x:25" />
      </value>
      <value id="dpos" label="Destination Position" group="pos">
        <int ref="x:26" />
      </value>
      <value id="jpos" label="Jack Position" group="jpos">
        <int ref="x:27" />
      </value>
    </status>
    <symbol xmlns="http://ciax.sum.naoj.org/ciax-xml/sdb">
      <enum id="ecode" label="ExitCode">
        <case class="hide" msg="OK">0000</case>
        <case class="alarm" msg="RW Region Error">0002</case>
        <case class="alarm" msg="CMD Code Error">0050</case>
        <case class="alarm" msg="Devide Num Error">0056</case>
        <case class="alarm" msg="Communication Error">005B</case>
        <case class="alarm" msg="CPU Watch timeout Error">0060</case>
        <case class="alarm" msg="Unknown">.</case>
      </enum>
      <enum id="rdy" ref="normal" />
      <enum id="pse" ref="warn" />
      <enum id="emg" ref="alarm" />
      <enum id="stp" ref="warn" />
      <enum id="run" ref="normal" />
      <enum id="jak" ref="normal" />
      <enum id="con" ref="normal" />
      <enum id="flt" ref="alarm" />
      <enum id="msr" ref="normal" />
      <enum id="msl" ref="normal" />
      <enum id="jd1" ref="normal" />
      <enum id="jd2" ref="normal" />
      <enum id="jd3" ref="normal" />
      <enum id="jd4" ref="normal" />
      <range id="motor" type="INT">
        <case class="alarm" msg="LOW">:10</case>
        <case class="normal" msg="OK">10&lt;:30</case>
        <case class="alarm" msg="HIGH">30&lt;:</case>
      </range>
      <enum id="mdar" ref="motor" />
      <enum id="mdal" ref="motor" />
      <range id="bvl" type="FLOAT">
        <case class="alarm" msg="LOW">:20</case>
        <case class="warn" msg="LESS">20&lt;:22</case>
        <case class="normal" msg="OK">22&lt;:26</case>
        <case class="warn" msg="FULL">26&lt;:28</case>
        <case class="alarm" msg="HIGH">28&lt;:</case>
      </range>
      <enum id="ist">
        <case class="normal" msg="MOIRCS">2</case>
        <case class="warn" msg="N/A">.</case>
      </enum>
      <enum id="jpos">
        <case class="normal" msg="D">0</case>
        <case class="normal" msg="1(L)">1</case>
        <case class="normal" msg="2(M)">2</case>
        <case class="normal" msg="3(H)">3</case>
        <case class="normal" msg="CHG">4</case>
        <case class="warn" msg="N/A">.</case>
      </enum>
    </symbol>
  </class>
</cdb>