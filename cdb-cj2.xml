<?xml version="1.0" encoding="utf-8"?>
<cdb xmlns="http://ciax.sum.naoj.org/ciax-xml/cdb">
  <class frame="cj2" id="cj2" label="Stand-by Flange PLC">
    <commands xmlns="http://ciax.sum.naoj.org/ciax-xml/cdbc">
      <cmdset id="upd" label="Regular status update">
        <command name="getstat" />
        <command name="geterr" />
        <command name="getzlen" />
      </cmdset>
      <cmdset id="clr" label="ClearBit">
        <command name="clrbit" />
        <command name="getcmd" />
      </cmdset>
      <cmdset id="stop" label="Emergency Stop">
        <command name="setbit">
          <argv>0</argv>
          <argv>0</argv>
        </command>
        <command name="getstat" />
      </cmdset>
      <cmdset id="pause" label="Pause">
        <command name="setbit">
          <argv>0</argv>
          <argv>1</argv>
        </command>
        <command name="getstat" />
      </cmdset>
      <cmdset id="resume" label="Resume Pause">
        <command name="setbit">
          <argv>0</argv>
          <argv>10</argv>
        </command>
        <command name="getstat" />
      </cmdset>
      <cmdset id="reset" label="Reset Error">
        <command name="setbit">
          <argv>0</argv>
          <argv>11</argv>
        </command>
        <command name="geterr" />
        <command name="getstat" />
      </cmdset>
      <cmdset id="ready" label="Drive Ready">
        <command name="setbit">
          <argv>0</argv>
          <argv>3</argv>
        </command>
        <command name="getstat" />
      </cmdset>
      <cmdset id="fhook" label="Fix Flange Hook">
        <command name="setbit">
          <argv>1</argv>
          <argv>0</argv>
        </command>
        <command name="getstat" />
        <command name="getcmd"></command>
        <command name="geterr" />
      </cmdset>
      <cmdset id="funhk" label="Fix Flange UnHook">
        <command name="setbit">
          <argv>1</argv>
          <argv>1</argv>
        </command>
        <command name="getstat"></command>
        <command name="getcmd"></command>
        <command name="geterr" />
      </cmdset>
      <cmdset id="fjup" label="Fix Flange Jack Up">
        <command name="setbit">
          <argv>1</argv>
          <argv>4</argv>
        </command>
        <command name="getstat" />
        <command name="getcmd"></command>
        <command name="geterr" />
      </cmdset>
      <cmdset id="fjdw" label="Fix Flange Jack Down">
        <command name="setbit">
          <argv>1</argv>
          <argv>5</argv>
        </command>
        <command name="getstat" />
        <command name="getcmd"></command>
        <command name="geterr" />
      </cmdset>
      <cmdset id="chgfw" label="Charging Plug Forward">
        <command name="setbit">
          <argv>1</argv>
          <argv>6</argv>
        </command>
        <command name="getstat" />
        <command name="getcmd"></command>
        <command name="geterr" />
      </cmdset>
      <cmdset id="chgbk" label="Charging Plug Backward">
        <command name="setbit">
          <argv>1</argv>
          <argv>7</argv>
        </command>
        <command name="getstat" />
        <command name="getcmd"></command>
        <command name="geterr" />
      </cmdset>
      <cmdset id="pwoff" label="Outlet Power Off">
        <command name="setbit">
          <argv>1</argv>
          <argv>8</argv>
        </command>
        <command name="getstat" />
      </cmdset>
      <cmdset id="mhook" label="Movable Flange Hook">
        <command name="setbit">
          <argv>2</argv>
          <argv>0</argv>
        </command>
        <command name="getstat" />
        <command name="getcmd"></command>
        <command name="geterr"></command>
      </cmdset>
      <cmdset id="munhk" label="Movable Flange UnHook">
        <command name="setbit">
          <argv>2</argv>
          <argv>1</argv>
        </command>
        <command name="getstat" />
        <command name="getcmd"></command>
        <command name="geterr"></command>
      </cmdset>
      <cmdset id="mrotout" label="Movable Flange Rotation for Loading">
        <command name="setbit">
          <argv>2</argv>
          <argv>2</argv>
        </command>
        <command name="getstat" />
        <command name="getcmd"></command>
        <command name="geterr"></command>
      </cmdset>
      <cmdset id="mrotin" label="Movable Flange Rotation for Storing">
        <command name="setbit">
          <argv>2</argv>
          <argv>3</argv>
        </command>
        <command name="getstat" />
        <command name="getcmd"></command>
        <command name="geterr" />
      </cmdset>
      <cmdset id="mjup" label="Movable Flange Jack Up">
        <command name="setbit">
          <argv>2</argv>
          <argv>4</argv>
        </command>
        <command name="getstat" />
        <command name="getcmd"></command>
        <command name="geterr" />
      </cmdset>
      <cmdset id="mjdw" label="Movable Flange Jack Down">
        <command name="setbit">
          <argv>2</argv>
          <argv>5</argv>
        </command>
        <command name="getstat" />
        <command name="getcmd"></command>
        <command name="geterr" />
      </cmdset>
      <cmdset id="trout" label="Movable Flange Transer Out">
        <command name="setbit">
          <argv>2</argv>
          <argv>6</argv>
        </command>
        <command name="getstat" />
        <command name="getcmd"></command>
        <command name="geterr" />
      </cmdset>
      <cmdset id="trin" label="Movable Flange Transer In">
        <command name="setbit">
          <argv>2</argv>
          <argv>7</argv>
        </command>
        <command name="getstat" />
        <command name="getcmd"></command>
        <command name="geterr" />
      </cmdset>
      <cmdset id="dopen" label="Door Open">
        <command name="setbit">
          <argv>3</argv>
          <argv>0</argv>
        </command>
        <command name="getstat" />
        <command name="getcmd"></command>
        <command name="geterr" />
      </cmdset>
      <cmdset id="dclose" label="Door Close">
        <command name="setbit">
          <argv>3</argv>
          <argv>1</argv>
        </command>
        <command name="getstat" />
        <command name="getcmd"></command>
        <command name="geterr" />
      </cmdset>
      <cmdset id="fpwon" label="Fix Flange Instrument Power On">
        <command name="setbit">
          <argv>3</argv>
          <argv>2</argv>
        </command>
        <command name="getstat" />
      </cmdset>
      <cmdset id="fpwoff" label="Fix Flange Instrument Power Off">
        <command name="setbit">
          <argv>3</argv>
          <argv>3</argv>
        </command>
        <command name="getstat" />
      </cmdset>
      <cmdset id="mpwon" label="Movable Flange Instrument Power On">
        <command name="setbit">
          <argv>3</argv>
          <argv>4</argv>
        </command>
        <command name="getstat" />
      </cmdset>
      <cmdset id="mpwoff" label="Movable Flange Instrument Power Off">
        <command name="setbit">
          <argv>3</argv>
          <argv>5</argv>
        </command>
        <command name="getstat" />
      </cmdset>
      <cmdset id="fccdon" label="Fix Flange CCD Power On">
        <command name="setbit">
          <argv>3</argv>
          <argv>8</argv>
        </command>
        <command name="getstat" />
      </cmdset>
      <cmdset id="fccdoff" label="Fix Flange CCD Power Off">
        <command name="setbit">
          <argv>3</argv>
          <argv>9</argv>
        </command>
        <command name="getstat" />
      </cmdset>
      <cmdset id="fccdtoff" label="Fix Flange CCD Timer Off">
        <command name="setbit">
          <argv>3</argv>
          <argv>10</argv>
        </command>
        <command name="getstat" />
        <command name="getcmd"></command>
        <command name="geterr" />
      </cmdset>
      <cmdset id="mccdon" label="Movable Flange CCD Power On">
        <command name="setbit">
          <argv>3</argv>
          <argv>12</argv>
        </command>
        <command name="getstat" />
      </cmdset>
      <cmdset id="mccdoff" label="Movable Flange CCD Power Off">
        <command name="setbit">
          <argv>3</argv>
          <argv>13</argv>
        </command>
        <command name="getstat" />
      </cmdset>
      <cmdset id="mccdtoff" label="Movable Flange CCD Timer Off">
        <command name="setbit">
          <argv>3</argv>
          <argv>14</argv>
        </command>
        <command name="getstat" />
        <command name="getcmd"></command>
        <command name="geterr" />
      </cmdset>
    </commands>
    <status xmlns="http://ciax.sum.naoj.org/ciax-xml/cdbs">
      <row label="General">
        <value id="ctl" label="CONTROL" symbol="ctl">
          <binary bit="6" ref="w:0" />
          <binary bit="7" ref="w:0" />
        </value>
        <value id="pse" label="PAUSE" symbol="warn">
          <binary bit="1" ref="w:0" />
        </value>
        <value id="rdy" label="READY" symbol="off-warn">
          <binary bit="3" ref="w:0" />
        </value>
        <value id="err" label="Error" symbol="err">
          <int ref="err" />
        </value>
        <value id="emg" label="EMG STOP" symbol="alarm">
          <binary bit="0" ref="w:0" />
        </value>
      </row>
      <row>
        <value id="exe" label="EXECUTING" symbol="exe">
          <string ref="c:0" />
          <string ref="c:1" />
          <string ref="c:2" />
          <string ref="c:3" />
        </value>
        <value id="run" label="Running" symbol="warn">
          <binary bit="15" ref="w:0" />
        </value>
        <value id="cmp" label="COMMAND COMPLETE" symbol="warn">
          <binary bit="14" ref="w:0" />
        </value>
      </row>
      <row label="Fix Jack Bolt">
        <value id="fis" label="Fix Attach" symbol="ist">
          <binary bit="0" ref="w:2" />
          <binary bit="1" ref="w:2" />
          <binary bit="2" ref="w:2" />
          <binary bit="3" ref="w:2" />
        </value>
        <value id="fhk" label="Fix Hook" symbol="hook">
          <binary bit="0" ref="w:1" />
          <binary bit="1" ref="w:1" />
        </value>
        <value id="fjb" label="Fix Jack Bolt" symbol="jack">
          <binary bit="14" ref="w:1" />
          <binary bit="15" ref="w:1" />
        </value>
      </row>
      <row label="Mov Jack Bolt">
        <value id="mis" label="Mov Attach" symbol="ist">
          <binary bit="0" ref="w:6" />
          <binary bit="1" ref="w:6" />
          <binary bit="2" ref="w:6" />
          <binary bit="3" ref="w:6" />
        </value>
        <value id="mhk" label="Mov Hook" symbol="hook">
          <binary bit="0" ref="w:5" />
          <binary bit="1" ref="w:5" />
        </value>
        <value id="mjb" label="Mov Jack Bolt" symbol="jack">
          <binary bit="14" ref="w:5" />
          <binary bit="15" ref="w:5" />
        </value>
      </row>
      <row label="Mov Transer">
        <value id="mrt" label="Mov Rotation" symbol="rot">
          <binary bit="2" ref="w:5" />
          <binary bit="3" ref="w:5" />
        </value>
        <value id="mtr" label="Mov Transer" symbol="mov">
          <binary bit="8" ref="w:6" />
          <binary bit="6" ref="w:6" />
        </value>
      </row>
      <row label="Fix Power Status" width="3">
        <value id="fpw" label="Fix Inst Power" symbol="off-warn">
          <binary bit="8" ref="w:9" />
        </value>
        <value id="fph" label="Fix PW RST" symbol="rst">
          <binary bit="0" ref="w:10" />
          <binary bit="1" ref="w:10" />
          <binary bit="2" ref="w:10" />
        </value>
        <value id="fcc" label="Fix CCD Power" symbol="off-warn">
          <binary bit="10" ref="w:9" />
        </value>
      </row>
      <row label="Mov Power Status" width="3">
        <value id="mpw" label="Mov Inst Power" symbol="off-warn">
          <binary bit="9" ref="w:9" />
        </value>
        <value id="mph" label="Mov PW RST" symbol="rst">
          <binary bit="8" ref="w:10" />
          <binary bit="9" ref="w:10" />
          <binary bit="10" ref="w:10" />
        </value>
        <value id="mcc" label="Mov CCD Power" symbol="off-warn">
          <binary bit="11" ref="w:9" />
        </value>
      </row>
      <row>
        <repeat from="1" to="4">
          <value id="fz%d" label="Fix Z">
            <float format="%.2f" ref="d:($_-1)" formula="$#/100" />
          </value>
        </repeat>
      </row>
      <row>
        <repeat from="1" to="4">
          <value id="mz%d" label="Mov Z">
            <float format="%.2f" ref="d:($_+3)" formula="$#/100" />
          </value>
        </repeat>
      </row>
      <row label="Instrument ID">
        <value id="fid" label="Fix Instrument ID" symbol="iid_ac">
          <int ref="d:8" />
        </value>
        <value id="mid" label="Mov Instrument ID" symbol="iid_ac">
          <int ref="d:9" />
        </value>
      </row>
      <row label="Charging">
        <value id="chg" label="CHG Plug" symbol="mov">
          <binary bit="6" ref="w:2" />
          <binary bit="7" ref="w:2" />
        </value>
        <value id="ccn" label="CHG Connect" symbol="off-warn">
          <binary bit="8" ref="w:4" />
        </value>
        <value id="cpw" label="CHG Power" symbol="off-warn">
          <binary bit="12" ref="w:4" />
        </value>
        <value id="dor" label="Door" symbol="dor">
          <binary bit="0" ref="w:9" />
          <binary bit="1" ref="w:9" />
        </value>
      </row>
    </status>
    <watch interval="1" xmlns="http://ciax.sum.naoj.org/ciax-xml/wdb">
      <periodic label="Regular" period="300">
        <command name="getstat"></command>
        <command name="geterr"></command>
        <command name="getzlen"></command>
      </periodic>
      <while label="On Motion" blocking="^[fmtd].+">
        <condition>
          <value ref="run">1</value>
        </condition>
        <interrupt name="setbit">
          <!--pause-->
          <argv>0</argv>
          <argv>1</argv>
        </interrupt>
        <command name="getstat" />
      </while>
      <onchange label="On Completion">
        <condition>
          <value ref="cmp">1</value>
        </condition>
        <command name="clrbit" />
        <command name="getstat" />
        <command name="getcmd" />
      </onchange>
      <onchange label="On ErrReset">
        <condition>
          <value ref="err">0</value>
        </condition>
        <command name="clrbit" />
        <command name="geterr" />
      </onchange>
      <onchange label="On Error">
        <condition>
          <value ref="err">[^0]</value>
        </condition>
        <command name="set">
          <argv>exe</argv>
          <argv>0</argv>
        </command>
      </onchange>
      <onchange label="On Emergency">
        <condition>
          <value ref="emg">1</value>
        </condition>
        <command name="clrbit" />
        <command name="getstat" />
      </onchange>
      <onchange label="On Pause">
        <condition>
          <value ref="pse">1</value>
        </condition>
        <command name="clrbit" />
        <command name="setbit">
          <!--resetp-->
          <argv>0</argv>
          <argv>10</argv>
        </command>
        <command name="getstat" />
      </onchange>
      <onchange label="Off Pause">
        <condition>
          <value ref="pse">0</value>
        </condition>
        <command name="clrbit" />
        <command name="getstat" />
      </onchange>
    </watch>
  </class>
  <symbol xmlns="http://ciax.sum.naoj.org/ciax-xml/sdb">
    <table id="exe" type="string">
      <case class="normal" msg="OFF">0000</case>
      <case class="warn" msg="ON" />
    </table>
    <table id="rst" type="string">
      <case class="normal" msg="OK">111</case>
      <case class="normal" msg="OFF">000</case>
      <case class="alarm" msg="BAD" />
    </table>
    <table id="ist" type="string">
      <case class="normal" msg="ON ">1111</case>
      <case class="warn" msg="OFF">0000</case>
      <case class="alarm" msg="N/A" />
    </table>
    <table id="hook" type="string">
      <case class="normal" msg="HOOK">10</case>
      <case class="normal" msg="UNHK">01</case>
      <case class="alarm" msg="N/A">00</case>
    </table>
    <table id="jack" type="string">
      <case class="normal" msg="UP">10</case>
      <case class="normal" msg="DW">01</case>
      <case class="alarm" msg="N/A">00</case>
    </table>
    <table id="ctl" type="string">
      <case class="normal" msg="AUTO">10</case>
      <case class="normal" msg="MANUAL">01</case>
      <case class="alarm" msg="N/A">00</case>
    </table>
    <table id="mov" type="string">
      <case class="normal" msg="FW">10</case>
      <case class="normal" msg="BK">01</case>
      <case class="alarm" msg="N/A">00</case>
    </table>
    <table id="rot" type="string">
      <case class="normal" msg="LOAD">10</case>
      <case class="normal" msg="STORE">01</case>
      <case class="alarm" msg="N/A">00</case>
    </table>
    <table id="dor" type="string">
      <case class="normal" msg="OPEN">10</case>
      <case class="normal" msg="CLOSE">01</case>
      <case class="alarm" msg="N/A">00</case>
    </table>
    <table id="err" type="string">
      <case class="normal" msg="OK">0</case>
      <case class="alarm" msg="PLC Failure">2</case>
      <case class="alarm" msg="Emg Stop">3</case>
      <case class="alarm" msg="FIX Hook operation">17</case>
      <case class="alarm" msg="FIX UnHook operation">18</case>
      <case class="alarm" msg="FIX EJB1 operation">21</case>
      <case class="alarm" msg="FIX EJB2 operation">22</case>
      <case class="alarm" msg="FIX EJB3 operation">23</case>
      <case class="alarm" msg="FIX EJB4 operation">24</case>
      <case class="alarm" msg="FIX EJB1 servo">25</case>
      <case class="alarm" msg="FIX EJB2 servo">26</case>
      <case class="alarm" msg="FIX EJB3 servo">27</case>
      <case class="alarm" msg="FIX EJB4 servo">28</case>
      <case class="alarm" msg="FIX Plug forward operation">33</case>
      <case class="alarm" msg="FIX Plug backward operation">34</case>
      <case class="alarm" msg="FIX Plug contact">35</case>
      <case class="alarm" msg="MOV Hook operation">49</case>
      <case class="alarm" msg="MOV UnHook operation">50</case>
      <case class="alarm" msg="MOV Flange R operation">51</case>
      <case class="alarm" msg="MOV Flange L operation">52</case>
      <case class="alarm" msg="MOV EJB5 operation">53</case>
      <case class="alarm" msg="MOV EJB6 operation">54</case>
      <case class="alarm" msg="MOV EJB7 operation">55</case>
      <case class="alarm" msg="MOV EJB8 operation">56</case>
      <case class="alarm" msg="MOV EJB5 servo">57</case>
      <case class="alarm" msg="MOV EJB6 servo">58</case>
      <case class="alarm" msg="MOV EJB7 servo">59</case>
      <case class="alarm" msg="MOV EJB8 servo">60</case>
      <case class="alarm" msg="MOV Transer forward operation">65</case>
      <case class="alarm" msg="MOV Transer backward operation">66</case>
      <case class="alarm" msg="MOV Transer inverter">67</case>
      <case class="alarm" msg="FIX Power Balance R-S">81</case>
      <case class="alarm" msg="FIX Power Balance S-T">82</case>
      <case class="alarm" msg="FIX Power Balance T-R">83</case>
      <case class="alarm" msg="MOV Power Balance R-S">89</case>
      <case class="alarm" msg="MOV Power Balance S-T">90</case>
      <case class="alarm" msg="MOV Power Balance T-R">91</case>
      <case class="alarm" msg="Shutter up operation">97</case>
      <case class="alarm" msg="Shutter down operation">98</case>
      <case class="alarm" msg="Failure" />
    </table>
  </symbol>
</cdb>
