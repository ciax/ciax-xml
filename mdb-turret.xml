<?xml version="1.0" encoding="utf-8"?>
<mdb xmlns="http://ciax.sum.naoj.org/ciax-xml/mdb">
  <macro id="turret" version="0" label="Turret Control" port="55555">
    <group id="tr_main" caption="Turret Commands" column="2">
      <item id="init_hall" label="Initialize Hall sensor">
        <exec site="mft" name="set6v"/>
        <exec site="mft" name="upd"/>
      </item>
      <item id="gh_wheel" label="Go to Home Position">
        <goal label="All Home?">
          <match form="msg" site="mft" var="v1">HOME</match>
          <match form="msg" site="mft" var="v2">HOME</match>
          <match form="msg" site="mft" var="v3">HOME</match>
          <match form="msg" site="mft" var="v4">HOME</match>
          <match form="msg" site="mft" var="v5">HOME</match>
          <match form="msg" site="mft" var="v6">HOME</match>
        </goal>
        <exec site="mix" name="posinit"/>
        <wait retry="5" label="Start?">
          <not form="msg" var="stp" site="mix">STOP</not>
        </wait>
        <wait retry="300" label="Run end?">
          <equal form="msg" var="stp" site="mix">STOP</equal>
        </wait>
      </item>
      <item id="init" label="Initialize Turret">
        <exec site="mix" name="upd"/>
        <mcr name="init_hall"/>
        <mcr name="gh_wheel"/>
        <mcr name="gh_wheel"/>
        <mcr name="gh_wheel"/>
      </item>
    </group>
  </macro>
</mdb>
