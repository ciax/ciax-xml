<?xml version="1.0" encoding="utf-8"?>
<mdb xmlns="http://ciax.sum.naoj.org/ciax-xml/mdb">
  <macro id="turret" version="0" label="Turret Control" port="55555">
    <group id="grp_init" caption="Initialize" rank="0">
      <item id="tinit" label="Initialize Turret">
        <cfg site="mft" name="set6v"/>
        <mcr name="pre_pos"/>
        <upd site="mft"/>
        <mcr name="gh_wheel" retry="3"/>
        <cfg site="mix" name="resetp"/>
        <mcr name="lineup"/>
      </item>
    </group>
    <group id="tr_sub" caption="Turret Commands" rank="1">
      <item id="pre_home" label="Pre-Homing">
        <goal label="All Pre-Home?" verify="true">
          <match form="data" site="mix" var="mp1">0.0</match>
          <match form="data" site="mix" var="mp2">0.0</match>
          <match form="data" site="mix" var="mp3">0.0</match>
          <match form="data" site="mix" var="mp4">0.0</match>
          <match form="data" site="mix" var="mp5">0.0</match>
          <match form="data" site="mix" var="mp6">0.0</match>
        </goal>
        <exec site="mix" name="home"/>
        <wait retry="20" label="Start?">
          <not form="msg" var="stp" site="mix">STOP</not>
        </wait>
        <wait retry="300" label="Run end?">
          <equal form="msg" var="stp" site="mix">STOP</equal>
        </wait>
      </item>
      <item id="pre_pos" label="Pre-Positioning">
        <goal label="All Slot11?" verify="true">
          <match form="data" site="mix" var="mp1">11.0</match>
          <match form="data" site="mix" var="mp2">11.0</match>
          <match form="data" site="mix" var="mp3">11.0</match>
          <match form="data" site="mix" var="mp4">11.0</match>
          <match form="data" site="mix" var="mp5">11.0</match>
          <match form="data" site="mix" var="mp6">11.0</match>
        </goal>
        <mcr name="pre_home"/>
        <exec site="mix" name="bk_all">
          <argv>1</argv>
        </exec>
        <wait retry="20" label="Start?">
          <not form="msg" var="stp" site="mix">STOP</not>
        </wait>
        <wait retry="300" label="Run end?">
          <equal form="msg" var="stp" site="mix">STOP</equal>
        </wait>
      </item>
      <item id="gh_wheel" label="Go to Home Position">
        <goal label="All Home?" verify="true">
          <match form="msg" site="mft" var="v1">HOME</match>
          <match form="msg" site="mft" var="v2">HOME</match>
          <match form="msg" site="mft" var="v3">HOME</match>
          <match form="msg" site="mft" var="v4">HOME</match>
          <match form="msg" site="mft" var="v5">HOME</match>
          <match form="msg" site="mft" var="v6">HOME</match>
        </goal>
        <exec site="mix" name="posinit"/>
        <wait retry="20" label="Start?">
          <not form="msg" var="stp" site="mix">STOP</not>
        </wait>
        <wait retry="600" label="Run end?">
          <equal form="msg" var="stp" site="mix">STOP</equal>
        </wait>
        <upd site="mft"/>
      </item>
      <item id="lineup" label="Initialize Turret">
        <exec site="mix" name="both_a">
          <argv>6</argv>
        </exec>
        <exec site="mix" name="both_b">
          <argv>6</argv>
        </exec>
        <exec site="mix" name="both_c">
          <argv>10</argv>
        </exec>
        <wait retry="20" label="Start?">
          <not form="msg" var="stp" site="mix">STOP</not>
        </wait>
        <wait retry="300" label="Run end?">
          <equal form="msg" var="stp" site="mix">STOP</equal>
        </wait>
      </item>
    </group>
  </macro>
</mdb>
