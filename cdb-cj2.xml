<?xml version="1.0" encoding="utf-8"?>
<cdb xsi:schemaLocation="http://ciax.sum.naoj.org/ciax-xml/schema/cdb.xsd" xmlns="http://ciax.sum.naoj.org/ciax-xml/cdb" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
  <class frame="cj2" id="cj2" label="Stand-by Flange PLC">
    <commands xmlns="http://ciax.sum.naoj.org/ciax-xml/cdbc">
      <session id="upd" label="Regular status update">
        <statement command="getstat" />
        <statement command="geterr" />
        <statement command="getzlen" />
      </session>
      <session id="clr" label="ClearBit">
        <statement command="clrbit" />
        <statement command="getstat" />
      </session>
      <session id="stop" label="Emergency Stop">
        <statement command="setbit">
          <argv>0</argv>
          <argv>0</argv>
        </statement>
        <statement command="getstat" />
      </session>
      <session id="pause" label="Pause">
        <statement command="setbit">
          <argv>0</argv>
          <argv>1</argv>
        </statement>
        <statement command="getstat" />
      </session>
      <session id="resetp" label="Reset Pause">
        <statement command="setbit">
          <argv>0</argv>
          <argv>10</argv>
        </statement>
        <statement command="getstat" />
      </session>
      <session id="ready" label="Drive Ready">
        <statement command="setbit">
          <argv>0</argv>
          <argv>3</argv>
        </statement>
        <statement command="getstat" />
      </session>
      <session id="reset" label="Reset Error">
        <statement command="setbit">
          <argv>0</argv>
          <argv>11</argv>
        </statement>
        <statement command="getstat" />
      </session>
      <session id="fhook" label="Fix Flange Hook">
        <statement command="setbit">
          <argv>1</argv>
          <argv>0</argv>
        </statement>
        <statement command="getstat" />
      </session>
      <session id="funhk" label="Fix Flange UnHook">
        <statement command="setbit">
          <argv>1</argv>
          <argv>1</argv>
        </statement>
        <statement command="getstat" />
      </session>
      <session id="fjup" label="Fix Flange Jack Up">
        <statement command="setbit">
          <argv>1</argv>
          <argv>4</argv>
        </statement>
        <statement command="getstat" />
      </session>
      <session id="fjdw" label="Fix Flange Jack Down">
        <statement command="setbit">
          <argv>1</argv>
          <argv>5</argv>
        </statement>
        <statement command="getstat" />
      </session>
      <session id="chgfw" label="Charging Plug Forward">
        <statement command="setbit">
          <argv>1</argv>
          <argv>6</argv>
        </statement>
        <statement command="getstat" />
      </session>
      <session id="chgbk" label="Charging Plug Backward">
        <statement command="setbit">
          <argv>1</argv>
          <argv>7</argv>
        </statement>
        <statement command="getstat" />
      </session>
      <session id="pwoff" label="Outlet Power Off">
        <statement command="setbit">
          <argv>1</argv>
          <argv>8</argv>
        </statement>
        <statement command="getstat" />
      </session>
      <session id="mhook" label="Movable Flange Hook">
        <statement command="setbit">
          <argv>2</argv>
          <argv>0</argv>
        </statement>
        <statement command="getstat" />
      </session>
      <session id="munhk" label="Movable Flange UnHook">
        <statement command="setbit">
          <argv>2</argv>
          <argv>1</argv>
        </statement>
        <statement command="getstat" />
      </session>
      <session id="mrotout" label="Movable Flange Rotation for Loading">
        <statement command="setbit">
          <argv>2</argv>
          <argv>2</argv>
        </statement>
        <statement command="getstat" />
      </session>
      <session id="mrotin" label="Movable Flange Rotation for Storing">
        <statement command="setbit">
          <argv>2</argv>
          <argv>3</argv>
        </statement>
        <statement command="getstat" />
      </session>
      <session id="mjup" label="Movable Flange Jack Up">
        <statement command="setbit">
          <argv>2</argv>
          <argv>4</argv>
        </statement>
        <statement command="getstat" />
      </session>
      <session id="mjdw" label="Movable Flange Jack Down">
        <statement command="setbit">
          <argv>2</argv>
          <argv>5</argv>
        </statement>
        <statement command="getstat" />
      </session>
      <session id="trout" label="Movable Flange Transer Out">
        <statement command="setbit">
          <argv>2</argv>
          <argv>6</argv>
        </statement>
        <statement command="getstat" />
      </session>
      <session id="trin" label="Movable Flange Transer In">
        <statement command="setbit">
          <argv>2</argv>
          <argv>7</argv>
        </statement>
        <statement command="getstat" />
      </session>
      <session id="dopen" label="Door Open">
        <statement command="setbit">
          <argv>3</argv>
          <argv>0</argv>
        </statement>
        <statement command="getstat" />
      </session>
      <session id="dclose" label="Door Close">
        <statement command="setbit">
          <argv>3</argv>
          <argv>1</argv>
        </statement>
        <statement command="getstat" />
      </session>
      <session id="fpwon" label="Fix Flange Instrument Power On">
        <statement command="setbit">
          <argv>3</argv>
          <argv>2</argv>
        </statement>
        <statement command="getstat" />
      </session>
      <session id="fpwoff" label="Fix Flange Instrument Power Off">
        <statement command="setbit">
          <argv>3</argv>
          <argv>3</argv>
        </statement>
        <statement command="getstat" />
      </session>
      <session id="mpwon" label="Movable Flange Instrument Power On">
        <statement command="setbit">
          <argv>3</argv>
          <argv>4</argv>
        </statement>
        <statement command="getstat" />
      </session>
      <session id="mpwoff" label="Movable Flange Instrument Power Off">
        <statement command="setbit">
          <argv>3</argv>
          <argv>5</argv>
        </statement>
        <statement command="getstat" />
      </session>
      <session id="fccdon" label="Fix Flange CCD Power On">
        <statement command="setbit">
          <argv>3</argv>
          <argv>8</argv>
        </statement>
        <statement command="getstat" />
      </session>
      <session id="fccdoff" label="Fix Flange CCD Power Off">
        <statement command="setbit">
          <argv>3</argv>
          <argv>9</argv>
        </statement>
        <statement command="getstat" />
      </session>
      <session id="fccdtoff" label="Fix Flange CCD Timer Off">
        <statement command="setbit">
          <argv>3</argv>
          <argv>10</argv>
        </statement>
        <statement command="getstat" />
      </session>
      <session id="mccdon" label="Movable Flange CCD Power On">
        <statement command="setbit">
          <argv>3</argv>
          <argv>12</argv>
        </statement>
        <statement command="getstat" />
      </session>
      <session id="mccdoff" label="Movable Flange CCD Power Off">
        <statement command="setbit">
          <argv>3</argv>
          <argv>13</argv>
        </statement>
        <statement command="getstat" />
      </session>
      <session id="mccdtoff" label="Movable Flange CCD Timer Off">
        <statement command="setbit">
          <argv>3</argv>
          <argv>14</argv>
        </statement>
        <statement command="getstat" />
      </session>
    </commands>
    <watch interval="1" xmlns="http://ciax.sum.naoj.org/ciax-xml/wdb">
      <periodic label="Regular" period="300">
        <statement command="getstat"></statement>
        <statement command="geterr"></statement>
        <statement command="getzlen"></statement>
      </periodic>
      <while label="On Motion" ref="exe" val="1">
        <blocking>^[fmtd].+</blocking>
        <interrupt command="setbit">
          <!--pause-->
          <argv>0</argv>
          <argv>1</argv>
        </interrupt>
        <statement command="getstat" />
      </while>
      <onchange label="On Completion" ref="cmp" val="1">
        <statement command="clrbit" />
        <statement command="getstat" />
      </onchange>
      <onchange label="On Emergency" ref="emg" val="1">
        <statement command="clrbit" />
        <statement command="getstat" />
      </onchange>
      <onchange label="On Pause" ref="pse" val="1">
        <statement command="clrbit" />
        <statement command="setbit">
          <!--resetp-->
          <argv>0</argv>
          <argv>10</argv>
        </statement>
        <statement command="getstat" />
      </onchange>
      <onchange label="Off Pause" ref="pse" val="0">
        <statement command="clrbit" />
        <statement command="getstat" />
      </onchange>
    </watch>
    <status xmlns="http://ciax.sum.naoj.org/ciax-xml/cdbs">
      <value id="emg" label="EMG STOP" group="g1">
        <binary bit="0" ref="w:0" />
      </value>
      <value id="ctl" label="CONTROL" group="g1">
        <binary bit="6" ref="w:0" />
        <binary bit="7" ref="w:0" />
      </value>
      <value id="pse" label="PAUSE" group="g1">
        <binary bit="1" ref="w:0" />
      </value>
      <value id="rdy" label="READY" group="g1">
        <binary bit="3" ref="w:0" />
      </value>
      <value id="cmp" label="COMMAND COMPLETE" group="g2">
        <binary bit="14" ref="w:0" />
      </value>
      <value id="exe" label="COMMAND EXEC" group="g2">
        <binary bit="15" ref="w:0" />
      </value>
      <value id="err" label="Error Code" group="g2">
        <int ref="err" />
      </value>
      <value id="fis" label="Fix Attach" group="fix">
        <binary bit="0" ref="w:2" />
        <binary bit="1" ref="w:2" />
        <binary bit="2" ref="w:2" />
        <binary bit="3" ref="w:2" />
      </value>
      <value id="fhk" label="Fix Hook" group="fix">
        <binary bit="0" ref="w:1" />
        <binary bit="1" ref="w:1" />
      </value>
      <value id="fjb" label="Fix Jack Bolt" group="fix">
        <binary bit="14" ref="w:1" />
        <binary bit="15" ref="w:1" />
      </value>
      <value id="mis" label="Mov Attach" group="mov1">
        <binary bit="0" ref="w:6" />
        <binary bit="1" ref="w:6" />
        <binary bit="2" ref="w:6" />
        <binary bit="3" ref="w:6" />
      </value>
      <value id="mhk" label="Mov Hook" group="mov1">
        <binary bit="0" ref="w:5" />
        <binary bit="1" ref="w:5" />
      </value>
      <value id="mjb" label="Mov Jack Bolt" group="mov1">
        <binary bit="14" ref="w:5" />
        <binary bit="15" ref="w:5" />
      </value>
      <value id="mrt" label="Mov Rotation" group="mov2">
        <binary bit="2" ref="w:5" />
        <binary bit="3" ref="w:5" />
      </value>
      <value id="mtr" label="Mov Transer" group="mov2">
        <binary bit="8" ref="w:6" />
        <binary bit="6" ref="w:6" />
      </value>
      <value id="fpw" label="Fix Inst Power" group="fix3">
        <binary bit="8" ref="w:9" />
      </value>
      <value id="fcc" label="Fix CCD Power" group="fix3">
        <binary bit="10" ref="w:9" />
      </value>
      <value id="mpw" label="Mov Inst Power" group="mov3">
        <binary bit="9" ref="w:9" />
      </value>
      <value id="mcc" label="Mov CCD Power" group="mov3">
        <binary bit="11" ref="w:9" />
      </value>
      <repeat from="1" to="4">
        <value id="fz%d" label="Fix Z" group="zf">
          <float format="%.2f" ref="d:($_-1)">$#/100</float>
        </value>
      </repeat>
      <repeat from="1" to="4">
        <value id="mz%d" label="Mov Z" group="zm">
          <float format="%.2f" ref="d:($_+3)">$#/100</float>
        </value>
      </repeat>
      <value id="fid" label="Fix Instrument ID" group="iid">
        <int ref="d:8" />
      </value>
      <value id="mid" label="Mov Instrument ID" group="iid">
        <int ref="d:9" />
      </value>
      <value id="chg" label="CHG Plug" group="other">
        <binary bit="6" ref="w:2" />
        <binary bit="7" ref="w:2" />
      </value>
      <value id="dor" label="Door" group="other">
        <binary bit="0" ref="w:9" />
        <binary bit="1" ref="w:9" />
      </value>
    </status>
    <symbol xmlns="http://ciax.sum.naoj.org/ciax-xml/sdb">
      <case id="ist">
        <enum class="normal" msg="ON">1111</enum>
        <enum class="normal" msg="OFF">0000</enum>
        <enum class="warn" msg="N/A"></enum>
      </case>
      <case id="hook">
        <enum class="normal" msg="HOOK">10</enum>
        <enum class="normal" msg="UNHOOK">01</enum>
        <enum class="alarm" msg="N/A">00</enum>
      </case>
      <case id="jack">
        <enum class="normal" msg="UP">10</enum>
        <enum class="normal" msg="DW">01</enum>
        <enum class="alarm" msg="N/A">00</enum>
      </case>
      <case id="emg" ref="alarm" />
      <case id="pse" ref="warn" />
      <case id="rdy" ref="off-warn" />
      <case id="cmp" ref="normal" />
      <case id="exe" ref="normal" />
      <case id="ctl">
        <enum class="normal" msg="AUTO">10</enum>
        <enum class="normal" msg="MANUAL">01</enum>
        <enum class="alarm" msg="N/A">00</enum>
      </case>
      <case id="fis" ref="ist" />
      <case id="fhk" ref="hook" />
      <case id="fjb" ref="jack" />
      <case id="mis" ref="ist" />
      <case id="mhk" ref="hook" />
      <case id="mjb" ref="jack" />
      <case id="mrt" ref="rot" />
      <case id="mtr" ref="mov" />
      <case id="chg" ref="mov" />
      <case id="mov">
        <enum class="normal" msg="FW">10</enum>
        <enum class="normal" msg="BK">01</enum>
        <enum class="alarm" msg="N/A">00</enum>
      </case>
      <case id="rot">
        <enum class="normal" msg="LOAD">10</enum>
        <enum class="normal" msg="STORE">01</enum>
        <enum class="alarm" msg="N/A">00</enum>
      </case>
      <case id="dor">
        <enum class="normal" msg="OPEN">10</enum>
        <enum class="normal" msg="CLOSE">01</enum>
        <enum class="alarm" msg="N/A">00</enum>
      </case>
      <case id="fpw" ref="off-warn" />
      <case id="fcc" ref="off-warn" />
      <case id="mpw" ref="off-warn" />
      <case id="mcc" ref="off-warn" />
      <case id="fid" ref="iid_ac" />
      <case id="mid" ref="iid_ac" />
    </symbol>
  </class>
</cdb>
