<?xml version="1.0" encoding="utf-8"?>
<adb xmlns="http://ciax.sum.naoj.org/ciax-xml/adb">
  <app frm_id="ixe" id="ixe" label="MOIRCS Turret">
    <commands xmlns="http://ciax.sum.naoj.org/ciax-xml/adbc">
      <group id="g0" caption="Device">
        <item id="upd" label="Update Status">
          <frmcmd name="getstat" />
          <repeat from="1" to="6">
            <frmcmd name="chkrun">
              <argv>$_</argv>
            </frmcmd>
            <frmcmd name="getp">
              <argv>$_</argv>
            </frmcmd>
            <frmcmd name="getspd">
              <argv>$_</argv>
            </frmcmd>
            <frmcmd name="getrmp">
              <argv>$_</argv>
            </frmcmd>
            <frmcmd name="getofs">
              <argv>$_</argv>
            </frmcmd>
          </repeat>
        </item>
        <item id="chkmov" label="Update Moving Status [1-6]" hidden="true">
          <par_num>1:6</par_num>
          <frmcmd name="chkrun">
            <argv>$1</argv>
          </frmcmd>
          <frmcmd name="getp">
            <argv>$1</argv>
          </frmcmd>
        </item>
        <item id="sysinit" label="System Initialize">
          <frmcmd name="initrot" />
          <frmcmd name="initunit" />
          <frmcmd name="initfactor" />
        </item>
        <item id="posinit" label="Position Initialize">
          <repeat from="1" to="6">
            <frmcmd name="init">
              <argv>$_</argv>
            </frmcmd>
            <frmcmd name="chkrun">
              <argv>$_</argv>
            </frmcmd>
          </repeat>
        </item>
        <item id="speed" label="Set Speed [25-800]">
          <par_num>25:800</par_num>
          <repeat from="1" to="6">
            <frmcmd name="set">
              <argv format="spd:%d">$_-1</argv>
              <argv>$1</argv>
            </frmcmd>
            <frmcmd name="setspd">
              <argv>$_</argv>
            </frmcmd>
          </repeat>
        </item>
        <item id="ramp" label="Set ramp [200-800]">
          <par_num>200:800</par_num>
          <repeat from="1" to="6">
            <frmcmd name="set">
              <argv format="rmp:%d">$_-1</argv>
              <argv>$1</argv>
            </frmcmd>
            <frmcmd name="setrmp">
              <argv>$_</argv>
            </frmcmd>
          </repeat>
        </item>
        <item id="resetp" label="Set 0 Pulses">
          <repeat from="1" to="6">
            <frmcmd name="set">
              <argv format="p:%d">$_-1</argv>
              <argv>0</argv>
            </frmcmd>
            <frmcmd name="setp">
              <argv>$_</argv>
            </frmcmd>
          </repeat>
        </item>
        <item id="backup" label="Backup Pulse,Speed,Offset">
          <frmcmd name="save">
            <argv>p,spd,ofs</argv>
          </frmcmd>
          <frmcmd name="deact" />
        </item>
        <item id="restore" label="Restore Pulse,Speed,Offset">
          <frmcmd name="act" />
          <frmcmd name="load" />
          <repeat from="1" to="6">
            <frmcmd name="setp">
              <argv>$_</argv>
            </frmcmd>
            <frmcmd name="setspd">
              <argv>$_</argv>
            </frmcmd>
            <frmcmd name="setofs">
              <argv>$_</argv>
            </frmcmd>
          </repeat>
        </item>
        <item id="fw" label="Move Forward [1-6(Turret)] [1-(hole)]">
          <par_num>1:6</par_num>
          <par_num>1:</par_num>
          <frmcmd name="fw">
            <argv>$1</argv>
            <argv format="%d">$2 * 8000</argv>
          </frmcmd>
          <frmcmd name="chkrun">
            <argv>$1</argv>
          </frmcmd>
        </item>
        <item id="bk" label="Move Backward [1-6(Turret)] [1-(hole)]">
          <par_num>1:6</par_num>
          <par_num>1:</par_num>
          <frmcmd name="bk">
            <argv>$1</argv>
            <argv format="%d">$2 * 8000</argv>
          </frmcmd>
          <frmcmd name="chkrun">
            <argv>$1</argv>
          </frmcmd>
        </item>
        <item id="abs" label="Move Absolute [1-6(Turret)] [0-48(hole)]">
          <par_num>1:6</par_num>
          <par_num>0:48</par_num>
          <frmcmd name="abs">
            <argv>$1</argv>
            <argv format="%d">$2 * 8000</argv>
          </frmcmd>
          <frmcmd name="chkrun">
            <argv>$1</argv>
          </frmcmd>
        </item>
        <item id="updp" label="Update Pulse" hidden="true">
          <par_num>1:6</par_num>
          <frmcmd name="chkrun">
            <argv>$1</argv>
          </frmcmd>
          <frmcmd name="getp">
            <argv>$1</argv>
          </frmcmd>
        </item>
        <item id="stop" label="Stop Run [1-6]" hidden="true">
          <par_num>1:6</par_num>
          <frmcmd name="stop">
            <argv>$1</argv>
          </frmcmd>
        </item>
      </group>
    </commands>
    <status xmlns="http://ciax.sum.naoj.org/ciax-xml/adbs">
      <group id="g1" caption="Stat" column="3">
        <binary id="rdy" label="Comm Ready" symbol="off-warn">
          <normal bit="0" ref="stat" />
        </binary>
        <binary id="srq" label="SRQ" symbol="off-warn">
          <normal bit="1" ref="stat" />
        </binary>
        <binary id="pme" label="Program Error" symbol="alarm">
          <normal bit="3" ref="stat" />
        </binary>
        <binary id="pse" label="Power Stage Error" symbol="alarm">
          <normal bit="4" ref="stat" />
        </binary>
        <binary id="oes" label="ONE EM Stop" symbol="alarm">
          <normal bit="5" ref="stat" />
        </binary>
        <binary id="ees" label="EXT EM Stop" symbol="alarm">
          <normal bit="6" ref="stat" />
        </binary>
      </group>
      <group caption="Mode" id="g2" column="2">
        <binary id="trm" label="Terminal Mode" symbol="off-warn">
          <normal bit="2" ref="stat" />
        </binary>
        <binary id="cmd" label="Computer Mode" symbol="off-warn">
          <normal bit="7" ref="stat" />
        </binary>
      </group>
      <group id="g3" caption="Turrets" column="5">
        <repeat_var from="1" to="6">
          <string id="r$_" label="Running $_">
            <field ref="run" index="$_-1" />
          </string>
          <integer id="p$_" label="Pulse $_">
            <field ref="p" index="$_-1" />
          </integer>
          <integer id="spd$_" label="Speed $_">
            <field ref="spd" index="$_-1" />
          </integer>
          <integer id="rmp$_" label="Ramp $_">
            <field ref="spd" index="$_-1" />
          </integer>
          <integer id="ofs$_" label="Offset $_">
            <field ref="ofs" index="$_-1" />
          </integer>
        </repeat_var>
      </group>
    </status>
    <watch xmlns="http://ciax.sum.naoj.org/ciax-xml/wdb" interval="1" period="3600">
      <repeat from="1" to="6">
        <event id="m$_" label="Moving $_">
          <pattern var="r$_">N</pattern>
          <block name="fw">
            <argv>$_</argv>
          </block>
          <block name="bk">
            <argv>$_</argv>
          </block>
          <block name="abs">
            <argv>$_</argv>
          </block>
          <int name="stop">
            <argv>$_</argv>
          </int>
          <exec name="updp">
            <argv>$_</argv>
          </exec>
        </event>
      </repeat>
    </watch>
  </app>
</adb>
