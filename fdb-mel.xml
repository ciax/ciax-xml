<?xml version="1.0" encoding="utf-8"?>
<fdb xmlns="http://ciax.sum.naoj.org/ciax-xml/fdb" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://ciax.sum.naoj.org/ciax-xml/schema/fdb.xsd">
  <frame id="mel" label="MELSEC Q Series" endian="little" ccmethod="len">
    <cmdframe xmlns="http://ciax.sum.naoj.org/ciax-xml/fdbc">
      <code length="2" label="SubHeader: Prefix">0x54</code>
      <string label="SubHeader: Serial Number">XX</string>
      <code length="2" label="SubHeader: Fixed Number">0</code>
      <code length="1" label="Q Header: Network Number">0</code>
      <code length="1" label="Q Header: PC Number">0xFF</code>
      <code length="2" label="Q Header: Request Unit I/O Number">0x3FF</code>
      <code length="1" label="Q Header: Request Unit Station Number">0</code>
      <code length="1" label="Q Header: Send Data Length MSB">${cc}</code>
      <code length="1" label="Q Header: Send Data Length LSB">0</code>
      <ccrange>
        <code length="2" label="Q Header: CPU Watch Timer">1</code>
        <select>
          <command id="getstat" label="Get all status" response="getstat" type="stat">
            <code length="2" label="Read region command">0x401</code>
            <code length="2" label="Read region subcommand">0</code>
            <code length="2" label="Start Address">0</code>
            <code length="2" label="Device Code">0xB400</code>
            <code length="2" label="Data Length">52</code>
          </command>
          <command id="set_tag" label="Set Tag to Run [1-12,98,99]" response="cmdrsp" type="config">
            <code length="2" label="Write region command">0x1401</code>
            <code length="2" label="Write region subcommand">0</code>
            <code length="2" label="Start Address">0x101</code>
            <code length="2" label="Device Code">0xB400</code>
            <code length="2" label="Data Length">1</code>
            <code length="2" valid="1:12,98,99">$1</code>
          </command>
          <command id="set_pos" label="Set Pos to Jack [0-4]" response="cmdrsp" type="config">
            <code length="2" label="Write region command">0x1401</code>
            <code length="2" label="Write region subcommand">0</code>
            <code length="2" label="Start Address">0x103</code>
            <code length="2" label="Device Code">0xB400</code>
            <code length="2" label="Data Length">1</code>
            <code length="2" valid="0:4">1 &lt;&lt; $1</code>
          </command>
          <command id="start" label="Start Trigger [b0=run,b8=jak,b15=chg]" response="cmdrsp" type="action">
            <code length="2" label="Write region command">0x1401</code>
            <code length="2" label="Write region subcommand">0</code>
            <code length="2" label="Start Address">0x102</code>
            <code length="2" label="Device Code">0xB400</code>
            <code length="2" label="Data Length">1</code>
            <code length="2" valid="0,8,15">1 &lt;&lt; $1</code>
          </command>
          <command id="stop" label="Stop Trigger [b0=pause,emg,,chg,cancel,reset,mater,cycle]" response="cmdrsp" type="action">
            <code length="2" label="Write region command">0x1401</code>
            <code length="2" label="Write region subcommand">0</code>
            <code length="2" label="Start Address">0x100</code>
            <code length="2" label="Device Code">0xB400</code>
            <code length="2" label="Data Length">1</code>
            <code length="2" valid="0:7">1 &lt;&lt; $1</code>
          </command>
          <command id="clear" label="Clear Action Flags" response="cmdrsp" type="config">
            <code length="2" label="Write region command">0x1401</code>
            <code length="2" label="Write region subcommand">0</code>
            <code length="2" label="Start Address">0x100</code>
            <code length="2" label="Device Code">0xB400</code>
            <code length="2" label="Data Length">4</code>
            <code length="2" label="Data">0</code>
            <code length="2" label="Data">0</code>
            <code length="2" label="Data">0</code>
            <code length="2" label="Data">0</code>
          </command>
          <command id="get_tbl" label="Get Jack Table [Tag=0-5] [JK=0-3]" response="get_tbl" type="stat">
            <code length="2" label="Read region command">0x401</code>
            <code length="2" label="Read region subcommand">0</code>
            <!--Jack 0=JK1,1=JK2,2=JK3,3=JK4-->
            <code length="1" label="Jack Num" valid="0:3">$2 * 4</code>
            <!--Tag 0=Tag1,1=Tag9,2=Tag10,3=Tag11,4=Tag12,5=Opsm-->
            <code length="1" label="Tag Num" valid="0:5">$1 + 2</code>
            <code length="2" label="Device Code">0xB400</code>
            <code length="2" label="Data Length">0x2c</code>
          </command>
          <command id="set_tbl" label="Set Jack Table from Field [Tag=0-5] [JK=0-3]" nocache="true" response="cmdrsp" type="config">
            <code length="2" label="Write region command">0x1401</code>
            <code length="2" label="Write region subcommand">0</code>
            <code length="1" label="Jack Num" valid="0:3">$2 * 4</code>
            <code length="1" label="Tag Num" valid="0:5">$1 + 2</code>
            <code length="2" label="Device Code">0xB400</code>
            <code length="2" label="Data Length">0x2c</code>
            <code length="2">${t:$1:$2}</code>
          </command>
          <command id="rw_tbl" label="Read/Write Jack Table [1=Read,2=Write]" response="cmdrsp" type="config">
            <code length="2" label="Write region command">0x1401</code>
            <code length="2" label="Write region subcommand">0</code>
            <code length="2" label="Start Address">0x7ff</code>
            <code length="2" label="Device Code">0xB400</code>
            <code length="2" label="Data Length">1</code>
            <code length="2" label="Parameter" valid="1:2">$1</code>
          </command>
        </select>
      </ccrange>
    </cmdframe>
    <rspframe xmlns="http://ciax.sum.naoj.org/ciax-xml/fdbr">
      <field decode="unsigned" label="SubHeader: Prefix" length="2">212</field>
      <field label="SubHeader: Serial Number" length="2">XX</field>
      <field decode="unsigned" label="SubHeader: Fixed Number" length="2">0</field>
      <field decode="unsigned" label="Q Header: Network Number" length="1">0</field>
      <field decode="unsigned" label="Q Header: PC Number" length="1">255</field>
      <field decode="unsigned" label="Q Header: Request Unit I/O Number" length="2">1023</field>
      <field decode="unsigned" label="Q Header: Request Unit Station Number" length="1">0</field>
      <field assign="cc" decode="unsigned" label="Response Data Length" length="2" />
      <ccrange>
        <field assign="ecode" decode="unsigned" label="Error Code" length="2">0</field>
        <select>
          <response id="getstat">
            <array assign="x" decode="signed" label="Status" length="2">
              <index range="0:51" size="52" />
            </array>
          </response>
          <response id="cmdrsp" label="command resp" />
          <response id="get_tbl">
            <array assign="t" decode="unsigned" label="Jack Pulse Tables" length="2">
              <index range="$1" size="6" />
              <index range="$2" size="4" />
              <index range="0:43" size="44" />
            </array>
          </response>
        </select>
      </ccrange>
    </rspframe>
  </frame>
</fdb>
