<?xml version="1.0" encoding="utf-8"?>
<adb xmlns="http://ciax.sum.naoj.org/ciax-xml/adb">
  <app frm_type="slo" id="mma" label="MOIRCS Arm">
    <commands xmlns="http://ciax.sum.naoj.org/ciax-xml/adbc">
      <command id="upd" label="Update Status">
        <frmcmd name="getstat" />
        <frmcmd name="bs" />
        <frmcmd name="p" />
        <repeat from="1" to="5">
          <frmcmd name="in">
            <argv>$_</argv>
          </frmcmd>
        </repeat>
      </command>
      <command id="reset" label="Reset">
        <frmcmd name="reset" />
      </command>
      <command id="defcon" label="Default Config">
        <frmcmd name="hl">
          <argv>1</argv>
        </frmcmd>
        <frmcmd name="e1">
          <argv>0</argv>
        </frmcmd>
        <frmcmd name="e2">
          <argv>0</argv>
        </frmcmd>
      </command>
      <command id="set0" label="Set 0 Pulses">
        <frmcmd name="set0" />
      </command>
      <command id="gf" label="Goto Focal Position">
        <frmcmd name="ma">
          <argv>12.8</argv>
        </frmcmd>
      </command>
      <command id="gr" label="Goto Rotate Position">
        <frmcmd name="ma">
          <argv>123</argv>
        </frmcmd>
      </command>
      <command id="gw" label="Goto Waiting Position">
        <frmcmd name="ma">
          <argv>185</argv>
        </frmcmd>
      </command>
      <command id="gs" label="Goto Stock Position">
        <frmcmd name="ma">
          <argv>jp</argv>
        </frmcmd>
      </command>
      <command id="sets" label="Set Stock Pos Pulse">
        <frmcmd name="setp">
          <argv>200.44</argv>
        </frmcmd>
      </command>
      <command id="rini" label="Init to RP at AV">
        <frmcmd name="e2">
          <argv>1</argv>
        </frmcmd>
        <frmcmd name="mhn"></frmcmd>
      </command>
      <command id="setr" label="Set Rotate Pos Pulse">
        <frmcmd name="setp">
          <argv>123</argv>
        </frmcmd>
      </command>
      <command id="updp" label="Update Pulse" hidden="true">
        <frmcmd name="p" />
        <frmcmd name="in">
          <argv>5</argv>
        </frmcmd>
        <frmcmd name="in">
          <argv>3</argv>
        </frmcmd>
      </command>
      <command id="stop" label="Stop Run" hidden="true">
        <frmcmd name="stop" />
      </command>
    </commands>
    <status xmlns="http://ciax.sum.naoj.org/ciax-xml/adbs" table="mma">
      <row label="Group">
        <value id="bs" label="Moter Moving" symbol="warn">
          <string ref="bs" />
        </value>
        <value id="con" label="Contact Sensor" symbol="normal">
          <string ref="in:4" />
        </value>
        <value id="err" label="Error Code" symbol="err">
          <int ref="err" />
        </value>
      </row>
      <row label="Group">
        <value id="pos" label="Arm Position" symbol="pos">
          <string ref="in:0" />
          <string ref="in:1" />
          <string ref="in:2" />
          <string ref="in:3" />
        </value>
        <value id="abs" label="ABS position" symbol="abs">
          <float ref="p" />
        </value>
      </row>
    </status>
    <watch xmlns="http://ciax.sum.naoj.org/ciax-xml/wdb" interval="1">
      <event label="Update Status">
        <range ref="elapse">300:</range>
        <exec name="upd"></exec>
      </event>
      <event label="On Motion">
        <pattern ref="bs">1</pattern>
        <block name="gf" />
        <block name="gr" />
        <block name="gw" />
        <block name="gs" />
        <int name="stop" />
        <exec name="updp"></exec>
      </event>
      <event label="Reset Config">
        <onchange ref="bs"></onchange>
        <pattern ref="bs">0</pattern>
        <exec name="defcon"></exec>
      </event>
    </watch>
  </app>
</adb>