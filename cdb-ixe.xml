<?xml version="1.0" encoding="iso-8859-1"?>
<cdb xsi:schemaLocation="http://ciax.sum.naoj.org/ciax-xml/schema/cdb.xsd" xmlns="http://ciax.sum.naoj.org/ciax-xml/cdb" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
  <class device="ixe" id="ixe" label="MOIRCS Turret">
    <commands>
      <session id="upd" label="Update Status">
        <statement>
          <text>getstat</text>
        </statement>
        <repeat from="1" to="6">
          <statement>
            <text>chkrun</text>
            <formula>$_</formula>
          </statement>
          <statement>
            <text>getp</text>
            <formula>$_</formula>
          </statement>
          <statement>
            <text>getspd</text>
            <formula>$_</formula>
          </statement>
          <statement>
            <text>getofs</text>
            <formula>$_</formula>
          </statement>
        </repeat>
      </session>
      <session id="sysinit" label="System Initialize">
        <statement>
          <text>initrot</text>
        </statement>
        <statement>
          <text>initunit</text>
        </statement>
        <statement>
          <text>initfactor</text>
        </statement>
      </session>
      <session id="emstop" label="Emergency Stop">
        <statement>
          <text>stop</text>
        </statement>
      </session>
      <session id="spd" label="Set Speed [0-800]">
        <parameters>
          <par label="[0-800]">
            <range>0:800</range>
          </par>
        </parameters>
        <repeat from="0" to="5">
          <statement>
            <text>set</text>
            <formula>"spd:$_"</formula>
            <formula>$1</formula>
          </statement>
        </repeat>
        <statement>
          <text>setspd_a</text>
        </statement>
        <statement>
          <text>setspd_b</text>
        </statement>
      </session>
      <session id="resetp" label="Set 0 Pulses">
        <repeat from="0" to="5">
          <statement>
            <text>set</text>
            <formula>"p:$_"</formula>
            <text>0</text>
          </statement>
        </repeat>
        <statement>
          <text>setp</text>
        </statement>
      </session>
      <session id="shutdown" label="Backup Pulse,Speed,Offset">
        <statement>
          <text>save</text>
          <text>p,spd,ofs</text>
        </statement>
        <statement>
          <text>deact</text>
        </statement>
      </session>
      <session id="resume" label="Resume Pulse,Speed,Offset">
        <statement>
          <text>act</text>
        </statement>
        <statement>
          <text>load</text>
        </statement>
        <statement>
          <text>setp_a</text>
        </statement>
        <statement>
          <text>setp_b</text>
        </statement>
        <statement>
          <text>setspd_a</text>
        </statement>
        <statement>
          <text>setspd</text>
        </statement>
        <statement>
          <text>setofs_a</text>
        </statement>
        <statement>
          <text>setofs_b</text>
        </statement>
      </session>
      <session id="upp" label="Update Pulse [1-6]">
        <parameters>
          <par label="[1-6]">
            <range>1:6</range>
          </par>
        </parameters>
        <statement>
          <text>chkrun</text>
          <formula>$1</formula>
        </statement>
        <statement>
          <text>getp</text>
          <formula>$1</formula>
        </statement>
      </session>
      <session id="fw" label="Move Forward [1-6] [1-6(hole)]" async="move">
        <parameters>
          <par label="[1-6]">
            <range>1:6</range>
          </par>
          <par label="[1-6(hole)]">
            <range>1:6</range>
          </par>
        </parameters>
        <statement>
          <text>fw</text>
          <formula>$1</formula>
          <formula>$2 * 8000</formula>
        </statement>
      </session>
      <session id="bk" label="Move Backward [1-6] [1-6(hole)]" async="move">
        <parameters>
          <par label="[1-6]">
            <range>1:6</range>
          </par>
          <par label="[1-6(hole)]">
            <range>1:6</range>
          </par>
        </parameters>
        <statement>
          <text>bk</text>
          <formula>$1</formula>
          <formula>$2 * 8000</formula>
        </statement>
      </session>
    </commands>
    <events interval="1">
      <repeat from="1" to="6">
        <while label="Moving $_" ref="r$_" val="N">
          <blocking>(fw|bk) $_</blocking>
          <interrupt>stop</interrupt>
          <execution>chkrun $_;getp $_</execution>
        </while>
      </repeat>
    </events>
    <status>
      <value id="rdy" format="%s" label="Comm Ready">
        <binary bit="0">stat</binary>
      </value>
      <value format="%s" id="srq" label="SRQ">
        <binary bit="1">stat</binary>
      </value>
      <value format="%s" id="pme" label="Program Error">
        <binary bit="3">stat</binary>
      </value>
      <value format="%s" id="pse" label="Power Stage Error">
        <binary bit="4">stat</binary>
      </value>
      <value format="%s" id="oes" label="ONE EM Stop">
        <binary bit="5">stat</binary>
      </value>
      <value format="%s" id="ees" label="EXT EM Stop">
        <binary bit="6">stat</binary>
      </value>
      <value format="%s" id="trm" label="Terminal Mode">
        <binary bit="2">stat</binary>
      </value>
      <value format="%s" id="cmd" label="Computer Mode">
        <binary bit="7">stat</binary>
      </value>
      <repeat from="1" to="6">
        <value format="%s" id="r$_" label="Running 1-6">
          <string>run:$_-1</string>
        </value>
        <value format="%d" id="p$_" label="Pulse 1-6">
          <int>p:$_-1</int>
        </value>
        <value format="%d" id="spd$_" label="Speed 1-6">
          <int>spd:$_-1</int>
        </value>
        <value format="%d" id="ofs$_" label="Offset 1-6">
          <int>ofs:$_-1</int>
        </value>
      </repeat>
    </status>
  </class>
</cdb>